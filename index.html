<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>אל עצמי</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="אפליקציה לניהול רגשי יומיומי ומדיטציות">
    <meta name="theme-color" content="#8cb89c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="אל עצמי">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="el_eztmi_logo_optimized.png">
    <link rel="icon" type="image/png" sizes="16x16" href="el_eztmi_logo_optimized.png">
    <link rel="apple-touch-icon" href="el_eztmi_logo_optimized.png">
    <link rel="manifest" href="manifest.json">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Alef:wght@400;700&family=Assistant:wght@300;400;500;600;700&family=Rubik:wght@300;400;500;600;700&family=Heebo:wght@300;400;500;600;700&family=Varela+Round&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #F9F9F7 0%, #F2F1ED 50%, #FAFAF8 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(249, 249, 247, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(140, 184, 156, 0.1);
            border: 1px solid rgba(140, 184, 156, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .logo {
            max-width: 300px;
            height: auto;
            margin-bottom: 10px;
        }
        
        .header h1 {
            font-family: 'Varela Round', 'Alef', 'Heebo', 'Rubik', 'Assistant', sans-serif;
            color: #8cb89c;
            font-size: 3.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(140, 184, 156, 0.15);
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .header p {
            color: #D4B896;
            font-size: 1.2em;
            font-weight: 300;
        }
        
        .nav-btn {
            background: transparent;
            color: #3a3a3a;
            border: none;
            padding: 12px 4px;
            cursor: pointer;
            font-size: 19px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            color: #111827;
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #D4B896;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .calendar-header {
            background: #8cb89c;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }
        
        .calendar-day {
            background: #F9F9F7;
            padding: 15px;
            min-height: 80px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border: 1px solid rgba(212, 184, 150, 0.5);
        }
        
        .calendar-day:hover {
            background: #F4F4F2;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(140, 184, 156, 0.15);
        }
        
        .calendar-day.other-month {
            background: #f5f0eb;
            color: #b5a397;
        }
        
        .calendar-day.today {
            background: linear-gradient(45deg, #8cb89c, #7AA689);
            color: white;
            font-weight: 600;
        }
        
        .calendar-day.has-entry {
            background: linear-gradient(45deg, #c7aca6, #bfa19b);
            color: white;
        }
        
        .day-number {
            font-weight: 600;
            font-size: 1.1em;
            color: #737373;
        }
        
        .calendar-day.today .day-number,
        .calendar-day.has-entry .day-number {
            color: white;
        }
        
        .day-special-icon {
            font-size: 14px;
            position: absolute;
            top: 5px;
            left: 5px;
            opacity: 0.9;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: #F9F9F7;
            margin: 2% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(140, 184, 156, 0.2);
            border: 1px solid rgba(140, 184, 156, 0.3);
        }
        
        .close {
            position: absolute;
            top: 15px;
            left: 25px;
            color: #b5a397;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close:hover {
            color: #8cb89c;
        }
        
        .modal h2 {
            color: #C86F7B;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8em;
            font-weight: 600;
        }
        
        .section {
            background: #F4F4F2;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 15px;
            border-right: 5px solid #D4B896;
            border: 1px solid rgba(212, 184, 150, 0.2);
        }
        
        .section h3 {
            color: #C86F7B;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .section.collapsed {
            background: #f0f4f8;
            border-right-color: #a0aec0;
        }
        
        .section.collapsed .section-content {
            display: none;
        }
        
        .section-toggle {
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Arrow for collapsible sections */
        .section-toggle::after {
            content: "▼";
            transition: transform 0.3s ease;
            color: #667eea;
            font-size: 14px;
        }
        
        .section.collapsed .section-toggle::after {
            transform: rotate(-90deg);
        }
        
        .warning-section {
            background: #fffbf0;
            border: 2px solid #f6ad55;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            color: #744210;
        }
        
        .warning-section h4 {
            color: #c05621;
            margin-bottom: 10px;
        }
        
        .mood-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .mood-btn {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2em;
        }
        
        .mood-btn.selected {
            background: #8cb89c;
            color: white;
            border-color: #8cb89c;
        }
        
        .reference-btn {
            background: #98bfa6;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            transition: all 0.3s ease;
        }
        
        .reference-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(152, 191, 166, 0.3);
            background: #87b095;
        }
        
        /* Google Sign-In */
        .google-signin-btn {
            background: #ffffff;
            color: #4285f4;
            border: 2px solid #4285f4;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .google-signin-btn:hover {
            background: #4285f4;
            color: white;
        }
        .google-icon { width: 20px; height: 20px; }
        
        textarea, input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 19px;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
            transition: border-color 0.3s ease;
        }
        
        textarea:focus, input:focus {
            outline: none;
            border-color: #8cb89c;
            box-shadow: 0 0 0 3px rgba(140, 184, 156, 0.1);
        }
        
        .breathing-exercise {
            text-align: center;
            padding: 20px;
        }
        
        .breathing-circle {
            width: 150px;
            height: 150px;
            border: 3px solid #8cb89c;
            border-radius: 50%;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            color: #8cb89c;
            background: transparent;
            box-shadow: 0 0 0 rgba(140, 184, 156, 0);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .breathing-circle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            background: rgba(152, 191, 166, 0.3);
            z-index: -1;
        }
        
        .breathing-btn {
            font-weight: bold !important;
            font-size: 18px !important;
        }
        
        .support-message {
            background: linear-gradient(45deg, #C86F7B, #B55E6A);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.1em;
            margin-bottom: 20px;
            position: relative;
        }
        
        .quote-content {
            font-size: 1.1em;
            line-height: 1.5;
        }
        
        .quote-symbol {
            font-size: 1.5em;
            color: rgba(255, 255, 255, 0.8);
            margin: 0 8px;
            vertical-align: middle;
        }
        
        .save-btn {
            background: linear-gradient(45deg, #8cb89c, #7AA689);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(140, 184, 156, 0.4);
        }
        
        .analysis-section {
            background: #F4F4F2;
            border-right-color: #C86F7B;
        }
        
        .analysis-section h3 {
            color: #C86F7B;
        }
        
        .pin-section {
            background: #F9F5E6;
            border: 2px solid #D4B896;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .pin-input {
            width: 200px;
            padding: 15px;
            font-size: 24px;
            text-align: center;
            letter-spacing: 5px;
            border: 2px solid #8cb89c;
            border-radius: 10px;
            margin: 10px;
        }
        
        /* Remember Me Checkbox Styling */
        .remember-me-box {
            margin: 1px 0;
            text-align: center;
        }
        
        .remember-me-label {
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            color: #6b7280;
            gap: 6px;
        }
        
        .remember-me-label input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #8cb89c;
            margin: 0;
        }
        
        .remember-me-box p {
            font-size: 11px;
            color: #999;
            margin: 1px 0 0 0;
        }
        
        /* Google Sign-In Button Centering */
        .google-signin-btn {
            display: block;
            margin: 0 auto 1px auto;
        }
        
        /* Reduce spacing between login cards */
        .login-card {
            margin-bottom: 4px;
        }
        
        .login-card--google {
            margin-bottom: 3px;
        }
        
        .login-card--local {
            margin-top: 3px;
        }
        
        /* Reduce spacing within login cards */
        .login-card h3 {
            margin-bottom: 3px;
        }
        
        .login-card p {
            margin-bottom: 4px;
        }
        
        .help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1001;
            backdrop-filter: blur(5px);
        }
        
        .help-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .export-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .export-btn {
            background: linear-gradient(45deg, #c6b79b, #B9A488);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .export-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(198, 183, 155, 0.3);
        }
        
        .reference-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1002;
            backdrop-filter: blur(5px);
        }
        
        .reference-content {
            background: white;
            margin: 2% auto;
            padding: 20px;
            border-radius: 20px;
            width: 95%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            text-align: center;
        }
        
        /* New Side Panel for Meditations */
        .meditations-side-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1003;
            backdrop-filter: blur(3px);
        }
        
        /* New Side Panel for Emotions Reference */
        .emotions-side-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1003;
            backdrop-filter: blur(3px);
        }
        
        .meditations-panel-content {
            position: fixed;
            top: 0;
            left: -100%;
            width: 90%;
            max-width: 400px;
            height: 100%;
            background: #f8f9fa;
            overflow-y: auto;
            transition: left 0.3s ease;
            box-shadow: 2px 0 20px rgba(0,0,0,0.2);
        }
        
        .meditations-side-panel.active .meditations-panel-content {
            left: 0;
        }
        
        .meditations-panel-header {
            background: #98bfa6;
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .meditations-panel-header h2 {
            margin: 0;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .meditations-close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }
        
        .meditations-close-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .meditations-panel-body {
            padding: 20px;
        }
        
        .emotions-panel-content {
            position: fixed;
            top: 0;
            left: -100%;
            width: 90%;
            max-width: 500px;
            height: 100%;
            background: #f8f9fa;
            overflow-y: auto;
            transition: left 0.3s ease;
            box-shadow: 2px 0 20px rgba(0,0,0,0.2);
        }
        
        .emotions-side-panel.active .emotions-panel-content {
            left: 0;
        }
        
        .emotions-panel-header {
            background: #98bfa6;
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .emotions-panel-header h2 {
            margin: 0;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .emotions-close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }
        
        .emotions-close-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .emotions-panel-body {
            padding: 20px;
        }
        
        /* New Side Panel for Needs Reference */
        .needs-side-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1003;
            backdrop-filter: blur(3px);
        }
        
        .needs-panel-content {
            position: fixed;
            top: 0;
            left: -100%;
            width: 90%;
            max-width: 500px;
            height: 100%;
            background: #f8f9fa;
            overflow-y: auto;
            transition: left 0.3s ease;
            box-shadow: 2px 0 20px rgba(0,0,0,0.2);
        }
        
        .needs-side-panel.active .needs-panel-content {
            left: 0;
        }
        
        .needs-panel-header {
            background: #98bfa6;
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .needs-panel-header h2 {
            margin: 0;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .needs-close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }
        
        .needs-close-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .needs-panel-body {
            padding: 20px;
        }
        
        .meditations-category {
            margin-bottom: 25px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            border-left: 4px solid #98bfa6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .meditations-category h3 {
            color: #4a5568;
            margin-bottom: 12px;
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .meditations-link {
            color: #4a5568;
            text-decoration: none;
            font-size: 14px;
            padding: 10px 12px;
            margin: 0;
            display: block;
            border-radius: 8px;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            background: #f8f9fa;
        }
        
        .meditations-link:hover {
            background: #98bfa6;
            color: white;
            border-color: #98bfa6;
            transform: translateX(-3px);
        }
        
        .favorite-circle {
            cursor: pointer;
            margin-left: 15px;
            transition: all 0.3s ease;
            user-select: none;
            width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: transparent;
            font-size: 26px;
            color: #8cb89c;
            font-weight: 610;
            line-height: 1;
            vertical-align: middle;
            text-align: center;
            flex-shrink: 0;
        }
        
        .meditations-link:hover .favorite-circle {
            transform: scale(1.1);
        }
        
        /* Ensure stars are aligned */
        .meditations-link {
            text-align: right;
            flex: 1;
        }
        
        .filter-favorites-btn {
            background: #98bfa6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 17px;
            transition: all 0.3s ease;
        }
        
        .filter-favorites-btn:hover {
            background: #7fa892;
            transform: translateY(-1px);
        }
        
        .filter-favorites-btn.active {
            background: #68a27d;
        }
        
        /* Emotions Modal Text Sizing */
        #emotionsModal h2 {
            font-size: calc(1.4em + 0.5px);
        }
        
        #emotionsModal h3 {
            font-size: calc(1.2em + 0.5px);
        }
        
        #emotionsModal p {
            font-size: calc(16px + 0.5px);
        }
        
        #emotionsModal strong {
            font-size: calc(16px + 0.5px);
        }
        
        /* Needs Modal Text Sizing */
        #needsModal h2 {
            font-size: calc(1.4em + 0.5px);
        }
        
        #needsModal h3 {
            font-size: calc(1.2em + 0.5px);
        }
        
        #needsModal p {
            font-size: calc(16px + 0.5px);
        }
        
        #needsModal strong {
            font-size: calc(16px + 0.5px);
        }
        
        .meditations-link-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 6px 0;
        }
        
        .reference-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        /* Login screen layout (match mock) */
        .login-title {
            font-family: 'Varela Round', 'Alef', 'Heebo', 'Rubik', 'Assistant', sans-serif;
            color: #374151;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            margin: 6px 0 18px 0;
        }
        .welcome-title {
            font-family: 'Varela Round', 'Alef', 'Heebo', 'Rubik', 'Assistant', sans-serif;
            color: #C86F7B;
            font-size: 18px;
            font-weight: 700;
            text-align: center;
            margin: -6px 0 6px 0;
        }
        .login-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            text-align: right;
        }
        .login-card--google h3,
        .login-card--local h3 {
            font-size: 15px;
            color: #374151;
            margin-bottom: 6px;
        }
        .login-card--google p,
        .login-card--local p {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .login-card--local { border-color: #cfe0d6; }
        .pin-box {
            background: #f5efe1;
            border: 1px solid #e6d7b9;
            border-radius: 10px;
            padding: 12px 12px 6px 12px;
            margin: 10px 0 6px 0;
        }
        .privacy-note {
            background: #d4e5da;
            border-radius: 10px;
            padding: 14px;
            font-size: 14px;
            color: #4b5563;
            margin-top: 10px;
        }

        /* Calendar hint spacing under greeting and above month */
        #mainApp .header { margin-bottom: 0 !important; }
        #mainApp .header p { margin-bottom: 0; }
        .calendar-hint {
            text-align: center;
            color: #6b7280;
            font-weight: 700;
            font-size: 19px;
            margin-top: 10px;   /* 10px under the greeting */
            margin-bottom: 35px; /* 35px above the month title */
        }
        
        @media (max-width: 768px) {
            .calendar {
                font-size: 0.9em;
            }
            
            .calendar-day {
                min-height: 60px;
                padding: 10px;
            }
            
            .modal-content {
                width: 95%;
                margin: 5% auto;
                padding: 20px;
            }
            
            .container {
                padding: 20px;
            }
            
            .header {
                margin-bottom: 80px;
            }
            
            /* keep actions fixed on mobile too */
            
            .export-options {
                justify-content: center;
                margin-top: 10px;
            }
            
            .header h1 {
                font-size: 2.5em;
                margin-bottom: 15px;
            }
            
            .favorite-circle {
                font-size: 30px;
                width: 36px;
                height: 36px;
                margin-left: 15px;
                min-width: 36px;
            }
        }
        
        /* Extra small screens */
        @media (max-width: 480px) {
            .favorite-circle {
                font-size: 34px;
                width: 40px;
                height: 40px;
                margin-left: 20px;
                min-width: 40px;
            }
        }

        /* Header actions (hamburger container) */
        .header-actions {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }

        /* Hamburger side menu */
        .hamburger {
            background: transparent;
            border: none;
            color: #3f3f3f;
            font-size: 26px;
            line-height: 1;
            padding: 8px 10px;
            cursor: pointer;
            border-radius: 8px;
        }

        .hamburger:focus {
            outline: 2px solid rgba(0,0,0,0.1);
            outline-offset: 2px;
        }

        .menu-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.25);
            z-index: 1100;
        }

        .side-menu {
            position: fixed;
            top: 0;
            right: 0;
            height: 100vh;
            width: 280px;
            max-width: 85vw;
            background: #ffffff;
            box-shadow: -2px 0 16px rgba(0,0,0,0.12);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1101;
            padding: 20px;
        }

        .side-menu.open {
            transform: translateX(0);
        }

        .side-menu .menu-close {
            position: absolute;
            top: 6px;
            left: 10px;
            background: transparent;
            border: none;
            font-size: 26px;
            color: #6b7280;
            cursor: pointer;
        }

        .side-menu .menu-list {
            list-style: none;
            margin: 0;
            padding: 40px 0 0 0;
        }

        .side-menu .menu-item {
            width: 100%;
            text-align: right;
            background: transparent;
            border: none;
            color: #3a3a3a;
            font-size: 16px;
            padding: 12px 4px;
            cursor: pointer;
        }

        .side-menu .menu-item:hover {
            color: #111827;
        }

        .menu-divider {
            border: none;
            border-top: 1px solid #eeeeee;
            margin: 8px 0;
        }
        
        .section-content {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 0 0 10px 10px;
            margin-top: -10px;
            border: 1px solid #e2e8f0;
            border-top: none;
        }
        
        .section-content.show {
            display: block;
        }
        
        .meditation-btn {
            background: #98bfa6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16.5px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(152, 191, 166, 0.3);
            width: 100%;
            max-width: 250px;
            margin: 0 auto;
            display: block;
        }
        
        .meditation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(152, 191, 166, 0.4);
            background: #87b095;
        }
        
        .meditation-link {
            color: #6b46c1;
            text-decoration: none;
            font-size: 17px;
            padding: 8px 12px;
            margin: 4px 0;
            display: block;
            border-radius: 8px;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        
        .meditation-link:hover {
            background: linear-gradient(45deg, rgba(159, 122, 234, 0.1), rgba(139, 92, 246, 0.1));
            border-color: rgba(159, 122, 234, 0.3);
            transform: translateX(-5px);
        }
        
        .meditation-category {
            margin-bottom: 30px;
            padding: 20px;
            background: #faf5ff;
            border-radius: 15px;
            border-left: 4px solid #9f7aea;
        }
        
        .meditation-category h3 {
            color: #6b46c1;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .meditation-grid {
            display: grid;
            gap: 8px;
        }
        
        #meditationsModal h3 {
            color: #C86F7B;
        }
        
        #meditationsModal a {
            color: #4a5568;
            text-decoration: none;
        }
        
        #meditationsModal a:hover {
            text-decoration: underline;
            color: #C86F7B;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="container" style="display: block;">
        <div class="header">
            <!-- Place for logo image - you'll need to replace the src with your actual image URL or base64 -->
            <img id="logoImage" 
                 src="logo.png" 
                 alt="אל עצמי - מסע של הקשבה והתרחבות הלב" 
                 style="max-width: 350px; width: 80%; height: auto; margin: 20px auto 10px; display: block;"
                 onerror="this.style.display='none'; document.getElementById('fallbackTitle').style.display='block';">
            <div id="fallbackTitle" style="display: none;">
                <p>מסע של הקשבה והתרחבות הלב</p>
            </div>
        </div>
        
        <div style="max-width: 520px; margin: 0 auto; text-align: center;">
            <div class="welcome-title" style="margin-bottom: 4px;">ברוכה הבאה 🌸</div>
            <div class="login-title" style="margin-bottom: 8px;">איך תרצי להתחבר כדי לצאת למסע שלך?</div>
                        <div class="login-card login-card--google">
                <h3 style="margin-bottom: 3px;">(מומלץ) התחברות עם Google</h3>
                <p style="margin-bottom: 4px;">הנתונים שלך נשמרים בענן וזמינים מכל מכשיר</p>
                <button id="googleFallbackBtn" class="google-signin-btn" onclick="handleGoogleSignIn()">
                    <svg class="google-icon" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.54z"/>
                    </svg>
                    התחבר עם Google
                </button>
                
                <!-- Remember Me Checkbox for Google -->
                <div class="remember-me-box">
                    <label class="remember-me-label">
                        <input type="checkbox" id="rememberMeGoogleCheckbox">
                        <span>השאר אותי מחוברת</span>
                    </label>
                </div>
                
                <p style="font-size: 15px; color: #666; margin-top: 0px;">הנתונים ייקשרו לחשבון ה‑Google שלך</p>
            </div>
            <div class="login-card login-card--local">
                <h3 style="margin-bottom: 3px;">שימוש מקומי בלבד</h3>
                <p style="margin-bottom: 4px;">הנתונים יישמרו רק במכשיר הזה</p>
                <div class="section" style="background: white; border: none; padding: 0;">
                    <input type="text" id="usernameInput" placeholder="...השם שלי" style="min-height: 50px; text-align: center; font-size: 18px;">
                </div>
                <div class="pin-box">
                    <h4 style="margin: 0 0 8px 0; color:#6b7280;">🔐 הגנה עם סיסמא (אופציונלי)</h4>
                    <input type="password" id="pinInput" class="pin-input" placeholder="****" maxlength="8" pattern="[0-9]{4,8}" style="margin: 6px auto; display:block;">
                    <p style="font-size: 15px; color: #666; text-align:center; margin: 4px 0 0 0;">השאירי ריק אם את לא רוצה סיסמא</p>
                </div>
                
                <!-- Remember Me Checkbox -->
                <div class="remember-me-box">
                    <label class="remember-me-label">
                        <input type="checkbox" id="rememberMeCheckbox">
                        <span>השאר אותי מחוברת</span>
                    </label>
                </div>
                
                <button class="save-btn" onclick="login()" style="margin-top: 4px;">התחלי ללא סנכרון ✍️</button>
            </div>

            <div class="privacy-note">
                <strong>🔒 פרטיות מלאה:</strong><br>
                בכניסה עם Google - הנתונים נשמרים בחשבון Google Drive הפרטי שלך<br>
                בכניסה מקומית - הנתונים נשמרים רק במכשיר הזה
            </div>
        </div>
    </div>
    
    <!-- Help Modal -->
    <div id="helpModal" class="help-modal">
        <div class="help-content">
            <span class="close" onclick="closeHelp()" style="position: absolute; top: 15px; left: 25px;">&times;</span>
            <h2>📚 מדריך שימוש - גיבוי ושחזור</h2>
            
            <div class="section">
                <h3>☁️ סנכרון עם Google Drive</h3>
                <p>אם התחברת עם חשבון Google, הנתונים שלך נשמרים אוטומטית בענן:</p>
                <p>• כל שינוי נשמר מיד ל-Google Drive</p>
                <p>• ניתן לגשת לנתונים מכל מכשיר</p>
                <p>• הגיבוי מתבצע אוטומטית</p>
            </div>
            
            <div class="section">
                <h3>💾 גיבוי מקומי</h3>
                <p>אם את משתמשת במערכת מקומית:</p>
                <p>• לחצי על כפתור "💾 שמירה" כדי לייצא את הנתונים</p>
                <p>• הקובץ יורד למחשב שלך</p>
                <p>• שמרי אותו במקום בטוח</p>
            </div>
            
            <div class="section">
                <h3>📂 שחזור נתונים</h3>
                <p>כדי לשחזר נתונים:</p>
                <p>• לחצי על כפתור "📂 שיחזור"</p>
                <p>• בחרי את קובץ הגיבוי שלך</p>
                <p>• הנתונים יוחזרו אוטומטית</p>
            </div>
            
            <div class="section">
                <h3>📊 ייצוא לאקסל</h3>
                <p>כדי לייצא לאקסל:</p>
                <p>• לחצי על כפתור "📊 אקסל"</p>
                <p>• הקובץ יורד בפורמט CSV</p>
                <p>• ניתן לפתוח ב-Excel או Google Sheets</p>
            </div>
        </div>
            </div>
            
    <!-- Meditations Library Modal -->
    <div id="meditationsModal" class="reference-modal">
        <div class="reference-content">
            <span class="close" onclick="closeMeditationsLibrary()" style="position: absolute; top: 15px; left: 25px;">×</span>
            <h2 style="margin-bottom: 15px; color: #4a5568;">🎧 אוסף מדיטציות</h2>
            <div style="text-align: right; line-height: 1.8; padding: 15px; background: #f9f9f9; border-radius: 15px; max-height: 70vh; overflow-y: auto;">
                
                <!-- שחרור לחץ וחרדה -->
                <div class="meditation-category">
                    <h3>🌊 שחרור לחץ וחרדה</h3>
                    <div class="meditation-grid">
                        <a class="meditation-link" href="https://www.meditationlibrary.net/הפסקת-מדיטציה-בחמש-דקות/" target="_blank">הפסקת מדיטציה לשחרור מידי מלחץ</a>
                        <a class="meditation-link" href="https://youtu.be/GjbQKAyVgeo" target="_blank">הרפיית שרירים הדרגתית</a>
                        <a class="meditation-link" href="https://www.meditationlibrary.net/דמיון-מודרך-לשחרור-רגשות-שליליים/" target="_blank">מדיטציה בדמיון מודרך לשחרור רגשות שליליים</a>
                        <a class="meditation-link" href="https://youtu.be/ANaIS9-o0Dw" target="_blank">מדיטציה לשחרור מחשבות טורדניות, חשיבת יתר ודאגות</a>
                        <a class="meditation-link" href="https://youtu.be/OZmEt7auY0k?si=iqvRVFfc4csOxEA3" target="_blank">מדיטציה בדמיון מודרך להרגעת של התקף חרדה וחרדה</a>
                        <a class="meditation-link" href="https://youtu.be/I65UTYRtd88?si=qyttbYXNZk25-zYq" target="_blank">מדיטציה קצרה לרגיעה ושחרור חרדות</a>
                    </div>
                </div>
                
                <!-- שינה טובה ועמוקה -->
                <div class="meditation-category">
                    <h3>🌜 שינה טובה ועמוקה</h3>
                    <div class="meditation-grid">
                        <a class="meditation-link" href="http://www.meditationlibrary.net/מדיטציה-לפני-השינה-לניקוי/" target="_blank">מדיטציה לפני השינה - לניקוי אנרגטי</a>
                        <a class="meditation-link" href="https://youtu.be/5ZcOF4Pjgwo" target="_blank">מדיטציה לשינה טקס לילי</a>
                        <a class="meditation-link" href="https://youtu.be/BeMlYGlQ6_Q" target="_blank">מדיטציית צלילה לשינה עמוקה</a>
                        <a class="meditation-link" href="https://youtu.be/QL2lmnWxSZY" target="_blank">מדיטציה ניקוי היום שחלף</a>
                    </div>
                </div>
                
                <!-- ביטחון עצמי, קבלה והעצמה אישית -->
                <div class="meditation-category">
                    <h3>🙌 ביטחון עצמי, קבלה והעצמה אישית</h3>
                    <div class="meditation-grid">
                        <a class="meditation-link" href="https://youtu.be/hQlsY1KDrXI" target="_blank">מדיטציה לחיזוק הביטחון העצמי ותחושת השליטה בחיים</a>
                        <a class="meditation-link" href="https://youtu.be/1LvT7VCP-go" target="_blank">להחזיר את שמחת החיים</a>
                        <a class="meditation-link" href="https://youtu.be/eN3Oqn6O4EU" target="_blank">מדיטציה בדיוק כפי שאני</a>
                        <a class="meditation-link" href="https://youtu.be/HTB5GDRjuwk?si=YPKvGESG1OoPNEJi" target="_blank">מדיטציה לחיזוק חשיבה חיובית העצמת הביטחון והשפע</a>
                        <a class="meditation-link" href="https://youtu.be/3jpb71IdYhc?si=JcNB03I4xFC0LX9O" target="_blank">מדיטציה לביטחון עצמי גבוה ואהבה עצמית - חיזוק ביטחון עצמי</a>
                    </div>
                </div>
                
                <!-- איזון רגשי והכלה של רגשות -->
                <div class="meditation-category">
                    <h3>⚖️ איזון רגשי והכלה של רגשות</h3>
                    <div class="meditation-grid">
                        <a class="meditation-link" href="https://youtu.be/ucnLfc0VJLA" target="_blank">ניקוי שחרור והרחבת הלב</a>
                        <a class="meditation-link" href="https://www.youtube.com/watch?v=TENB02x_cig" target="_blank">מדיטציה מיינדפולנס להרגעה ושלווה מידיים- 5 דקות</a>
                        <a class="meditation-link" href="https://youtu.be/AEAZuCKY8rM?si=CpGyN7w79JNyYay2" target="_blank">מדיטציה של נחמה</a>
                        <a class="meditation-link" href="https://youtu.be/qf18VzVA5YM" target="_blank">מדיטציה להרגעה גלי לב אוורור רגשות מודחקים</a>
                        <a class="meditation-link" href="https://youtu.be/n28rIELPaNM?si=M209MHgbxIWpzVTX" target="_blank">מדיטציה לשחרור עומס של מחשבות וחיבור לשקט ואיזון</a>
                    </div>
                </div>
                
                <!-- חיבור פנימי ורוחני -->
                <div class="meditation-category">
                    <h3>🧘‍♀️ חיבור פנימי ורוחני</h3>
                    <div class="meditation-grid">
                        <a class="meditation-link" href="https://youtu.be/xjfLdSecETw" target="_blank">תדרים לניקוי ופתיחת בלוטת האיצטרובל</a>
                        <a class="meditation-link" href="https://www.youtube.com/watch?v=RFsmhRUWuMQ" target="_blank">מדיטציית חיבור לקול הפנימי (מדיטציה כדרך להקשבה פנימית ולהכוונה)</a>
                        <a class="meditation-link" href="https://www.youtube.com/watch?v=YhcVMktL8do" target="_blank">מדיטציה לקבלת הדרכה מהאני העליון וחיבור לאינטואיציה</a>
                        <a class="meditation-link" href="https://youtu.be/xIH9qVjkA_w?si=L6TSRrCiLw2EBdS1" target="_blank">מדיטציה לפתיחת צ'קרת הלב ריפוי והתעוררות רוחנית</a>
                        <a class="meditation-link" href="https://youtu.be/tBY3G1ii-zk?si=DekJy9iCYKcmvd_w" target="_blank">מדיטציית חיבור לשליחות וחזון</a>
                    </div>
                </div>
                
                <!-- אהבה, קשרים זוגיים וחיבור בין אנשים -->
                <div class="meditation-category">
                    <h3>💕 אהבה, קשרים זוגיים וחיבור בין אנשים</h3>
                    <div class="meditation-grid">
                        <a class="meditation-link" href="https://www.meditationlibrary.net/דמיון-מודרך-כדור-הזהב/" target="_blank">דמיון מודרך כדור הזהב - עבודה עם אנרגיה מינית</a>
                        <a class="meditation-link" href="https://youtu.be/v_KR3vuczjI" target="_blank">הורמון האהבה - מדיטציה סבלימינלית להעלאת רמת האוקסיטוצין</a>
                        <a class="meditation-link" href="https://youtu.be/HUL34ZJmZ1o" target="_blank">מדיטציה למיגנוט חבר נשמתי וזוגיות לנשים</a>
                        <a class="meditation-link" href="http://www.meditationlibrary.net/תרגיל-בזימון-זוגיות/" target="_blank">תרגיל בזימון זוגיות</a>
                        <a class="meditation-link" href="https://youtu.be/usyI1Is9b1k" target="_blank">Love Signal 528 Hz</a>
                        <a class="meditation-link" href="https://youtu.be/JJCOozFQ178" target="_blank">פתיחת הלב ומגנוט הגבר של חייך</a>
                    </div>
                </div>
                
                <!-- ריפוי עצמי והחלמה -->
                <div class="meditation-category">
                    <h3>🌱 ריפוי עצמי והחלמה</h3>
                    <div class="meditation-grid">
                        <a class="meditation-link" href="https://www.meditationlibrary.net/מדיטציה-לניקוי-אנרגטי/" target="_blank">מדיטציה לניקוי התדר האנרגטי</a>
                        <a class="meditation-link" href="https://www.meditationlibrary.net/הצהרות-לבריאות-וריפוי/" target="_blank">הצהרות לריפוי ובריאות מושלמת (10 דקות)</a>
                        <a class="meditation-link" href="https://www.youtube.com/watch?v=RsImAZkQGNg" target="_blank">מדיטציה לריפוי הגוף, בריאות והחלמה</a>
                        <a class="meditation-link" href="https://youtu.be/uPU4VpPifIc?si=7nijPAsdscZQLDdp" target="_blank">מדיטציית ריפוי, החלמה, רוגע ובריאות פירמידה של החלמה</a>
                        <a class="meditation-link" href="https://www.youtube.com/watch?v=NpstQxsXPEI" target="_blank">מדיטציית החלמה וריפוי מפציעות בגוף-נפש (שעה ו-11 דקות)</a>
                        <a class="meditation-link" href="https://youtu.be/Wa1GEKagrHU?si=tiaBjKiAw_CsKF4k" target="_blank">מדיטציה לחיזוק הגוף, מערכת החיסון והתאוששות ממחלה</a>
                    </div>
                </div>
                
                <!-- חיוניות ואנרגיה חיובית -->
                <div class="meditation-category">
                    <h3>☀️ חיוניות ואנרגיה חיובית</h3>
                    <div class="meditation-grid">
                        <a class="meditation-link" href="https://youtu.be/ML4eMxWkFGU" target="_blank">מדיטציה לחשיבה חיובית ואנרגיה חיובית ב-6 דקות</a>
                        <a class="meditation-link" href="https://youtu.be/MU3Ic2dp3uw?si=7leq-EtdHa9SKpg8" target="_blank">מדיטציה לחשיבה חיובית, הכרת תודה שמחה ואופטימיות</a>
                        <a class="meditation-link" href="https://youtu.be/HTB5GDRjuwk?si=OUbN-Vi-MsRa39nS" target="_blank">מדיטציה לחיזוק חשיבה חיובית העצמת הביטחון והשפע</a>
                        <a class="meditation-link" href="https://youtu.be/ztxpPqkwQVg" target="_blank">זריקת מרץ ואנרגיה - אימון גלי מוח</a>
                        <a class="meditation-link" href="https://www.youtube.com/watch?v=YJGbi2cLzak" target="_blank">מדיטציה לבוקר טוב עם אנרגיות חיוביות</a>
                        <a class="meditation-link" href="https://youtu.be/PamCP6LzAag?si=RtxVK3I2re6IhKP9" target="_blank">לסדר את הבוקר ולהתחיל את היום עם חיוך ומוטיבציה</a>
                    </div>
                </div>
                
                <!-- שינוי והתפתחות אישית -->
                <div class="meditation-category">
                    <h3>💫 שינוי והתפתחות אישית</h3>
                    <div class="meditation-grid">
                        <a class="meditation-link" href="https://youtu.be/PcV2_5a8xqs" target="_blank">דמיון מודרך הכנה לקראת שינוי - פרק א'</a>
                        <a class="meditation-link" href="https://youtu.be/5ifOK-YsL0Q" target="_blank">דמיון מודרך לשינוי פרק ב'</a>
                        <a class="meditation-link" href="https://www.youtube.com/watch?v=MKlAN8e1GAY" target="_blank">מדיטציה ליצירת עתיד והפעלת כוחו של התת מודע ליצירת מציאות</a>
                        <a class="meditation-link" href="https://youtu.be/kXjIm3nQido?si=LboGG_7H3VeVjug-" target="_blank">מדיטציה לשנה החדשה</a>
                        <a class="meditation-link" href="https://youtu.be/kLaX9fpgV44?si=5tiTMsx9EKDSKdFE" target="_blank">מדיטציה לבניית האני העתידית</a>
                        <a class="meditation-link" href="https://youtu.be/ekJ8Yq6xoog?si=0NmIIOFmPzriqOOB" target="_blank">מדיטציה להגשמה – חוק המשיכה בפועלה</a>
                    </div>
                </div>
                
                <!-- שונות -->
                <div class="meditation-category">
                    <h3>🌈 שונות</h3>
                    <div class="meditation-grid">
                        <a class="meditation-link" href="https://youtu.be/Qwzv0EfiY-k?si=YB5GaI6Zyqjp-GIs" target="_blank">מדיטציית שפע כלכלי למשיכת כסף ,מזל ועושר</a>
                        <a class="meditation-link" href="https://youtu.be/0asyM8q8DPA?si=vud7gwWZzJRpTwxh" target="_blank">מדיטציה לשיפור הריכוז הזיכרון</a>
                        <a class="meditation-link" href="https://youtu.be/mB894cMo9Xg?si=QzfGQ0KI3VZdTBYw" target="_blank">מדיטציה לזמן מלחמה</a>
                        <a class="meditation-link" href="https://youtu.be/BZmCeIbp7UY?si=Dx10oSZMms3gAThi" target="_blank">התמודדות עם אובדן ושכול</a>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 15px; background: #d4e5da; border-radius: 10px; text-align: center;">
                    <strong style="color: #8cb89c;">🙏</strong> אוסף המדיטציות שלנו נאסף בקפידה מרחבי הרשת, אנו מודות מכל הלב לכל היוצרים והיוצרות שנותנים לנו השראה ומעשירים את עולמנו
                </div>
            </div>
        </div>
    </div>

    <!-- New Meditations Side Panel -->
    <div id="meditationsSidePanel" class="meditations-side-panel">
        <div class="meditations-panel-content">
            <div class="meditations-panel-header">
                <h2>🎧 אוסף מדיטציות</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="filter-favorites-btn" onclick="toggleFavoritesFilter()" id="favoritesFilterBtn">הצג מועדפות</button>
                    <button class="meditations-close-btn" onclick="closeMeditationsSidePanel()">×</button>
                </div>
            </div>
            <div class="meditations-panel-body">
                
                <p style="margin: 0 0 15px 0; color: #718096; font-size: 16px; text-align: center;">בחרי המדיטציות שתרצי לחזור אליהן והוסיפי למועדפים</p>
                
                <!-- שחרור לחץ וחרדה -->
                <div class="meditations-category">
                    <h3>🌊 שחרור לחץ וחרדה</h3>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://www.meditationlibrary.net/הפסקת-מדיטציה-בחמש-דקות/" target="_blank">
                            <span>הפסקת מדיטציה לשחרור מידי מלחץ</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'הפסקת מדיטציה לשחרור מידי מלחץ', event)"></span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/GjbQKAyVgeo" target="_blank">
                            <span>הרפיית שרירים הדרגתית</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'הרפיית שרירים הדרגתית', event)"></span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://www.meditationlibrary.net/דמיון-מודרך-לשחרור-רגשות-שליליים/" target="_blank">
                            <span>מדיטציה בדמיון מודרך לשחרור רגשות שליליים</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה בדמיון מודרך לשחרור רגשות שליליים', event)"></span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/ANaIS9-o0Dw" target="_blank">
                            <span>מדיטציה לשחרור מחשבות טורדניות, חשיבת יתר ודאגות</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לשחרור מחשבות טורדניות, חשיבת יתר ודאגות', event)"></span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/OZmEt7auY0k?si=iqvRVFfc4csOxEA3" target="_blank">
                            <span>מדיטציה בדמיון מודרך להרגעת של התקף חרדה וחרדה</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה בדמיון מודרך להרגעת של התקף חרדה וחרדה', event)"></span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/I65UTYRtd88?si=qyttbYXNZk25-zYq" target="_blank">
                            <span>מדיטציה קצרה לרגיעה ושחרור חרדות</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה קצרה לרגיעה ושחרור חרדות', event)"></span>
                    </div>
                </div>
                
                <!-- שינה טובה ועמוקה -->
                <div class="meditations-category">
                    <h3>🌜 שינה טובה ועמוקה</h3>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="http://www.meditationlibrary.net/מדיטציה-לפני-השינה-לניקוי/" target="_blank">
                            <span>מדיטציה לפני השינה - לניקוי אנרגטי</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לפני השינה - לניקוי אנרגטי', event)"></span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/5ZcOF4Pjgwo" target="_blank">
                            <span>מדיטציה לשינה טקס לילי</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לשינה טקס לילי', event)"></span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/BeMlYGlQ6_Q" target="_blank">
                            <span>מדיטציית צלילה לשינה עמוקה</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציית צלילה לשינה עמוקה', event)"></span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/QL2lmnWxSZY" target="_blank">
                            <span>מדיטציה ניקוי היום שחלף</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה ניקוי היום שחלף', event)"></span>
                    </div>
                </div>
                
                <!-- ביטחון עצמי, קבלה והעצמה אישית -->
                <div class="meditations-category">
                    <h3>🙌 ביטחון עצמי, קבלה והעצמה אישית</h3>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/hQlsY1KDrXI" target="_blank">
                            <span>מדיטציה לחיזוק הביטחון העצמי ותחושת השליטה בחיים</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לחיזוק הביטחון העצמי ותחושת השליטה בחיים', event)"></span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/1LvT7VCP-go" target="_blank">
                            <span>להחזיר את שמחת החיים</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'להחזיר את שמחת החיים', event)"></span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/eN3Oqn6O4EU" target="_blank">
                            <span>מדיטציה בדיוק כפי שאני</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה בדיוק כפי שאני', event)"></span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/HTB5GDRjuwk?si=YPKvGESG1OoPNEJi" target="_blank">
                            <span>מדיטציה לחיזוק חשיבה חיובית העצמת הביטחון והשפע</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לחיזוק חשיבה חיובית העצמת הביטחון והשפע', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/3jpb71IdYhc?si=JcNB03I4xFC0LX9O" target="_blank">
                            <span>מדיטציה לביטחון עצמי גבוה ואהבה עצמית - חיזוק ביטחון עצמי</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לביטחון עצמי גבוה ואהבה עצמית - חיזוק ביטחון עצמי', event)">○</span>
                    </div>
                </div>
                
                <!-- איזון רגשי והכלה של רגשות -->
                <div class="meditations-category">
                    <h3>⚖️ איזון רגשי והכלה של רגשות</h3>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/ucnLfc0VJLA" target="_blank">
                            <span>ניקוי שחרור והרחבת הלב</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'ניקוי שחרור והרחבת הלב', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://www.youtube.com/watch?v=TENB02x_cig" target="_blank">
                            <span>מדיטציה מיינדפולנס להרגעה ושלווה מידיים- 5 דקות</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה מיינדפולנס להרגעה ושלווה מידיים- 5 דקות', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/AEAZuCKY8rM?si=CpGyN7w79JNyYay2" target="_blank">
                            <span>מדיטציה של נחמה</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה של נחמה', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/qf18VzVA5YM" target="_blank">
                            <span>מדיטציה להרגעה גלי לב אוורור רגשות מודחקים</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה להרגעה גלי לב אוורור רגשות מודחקים', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/n28rIELPaNM?si=M209MHgbxIWpzVTX" target="_blank">
                            <span>מדיטציה לשחרור עומס של מחשבות וחיבור לשקט ואיזון</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לשחרור עומס של מחשבות וחיבור לשקט ואיזון', event)">○</span>
                    </div>
                </div>
                
                <!-- חיבור פנימי ורוחני -->
                <div class="meditations-category">
                    <h3>🧘‍♀️ חיבור פנימי ורוחני</h3>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/xjfLdSecETw" target="_blank">
                            <span>תדרים לניקוי ופתיחת בלוטת האיצטרובל</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'תדרים לניקוי ופתיחת בלוטת האיצטרובל', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://www.youtube.com/watch?v=RFsmhRUWuMQ" target="_blank">
                            <span>מדיטציית חיבור לקול הפנימי (מדיטציה כדרך להקשבה פנימית ולהכוונה)</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציית חיבור לקול הפנימי (מדיטציה כדרך להקשבה פנימית ולהכוונה)', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://www.youtube.com/watch?v=YhcVMktL8do" target="_blank">
                            <span>מדיטציה לקבלת הדרכה מהאני העליון וחיבור לאינטואיציה</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לקבלת הדרכה מהאני העליון וחיבור לאינטואיציה', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/xIH9qVjkA_w?si=L6TSRrCiLw2EBdS1" target="_blank">
                            <span>מדיטציה לפתיחת צ'קרת הלב ריפוי והתעוררות רוחנית</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לפתיחת צ\'קרת הלב ריפוי והתעוררות רוחנית', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/tBY3G1ii-zk?si=DekJy9iCYKcmvd_w" target="_blank">
                            <span>מדיטציית חיבור לשליחות וחזון</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציית חיבור לשליחות וחזון', event)">○</span>
                    </div>
                </div>
                
                <!-- אהבה, קשרים זוגיים וחיבור בין אנשים -->
                <div class="meditations-category">
                    <h3>💕 אהבה, קשרים זוגיים וחיבור בין אנשים</h3>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://www.meditationlibrary.net/דמיון-מודרך-כדור-הזהב/" target="_blank">
                            <span>דמיון מודרך כדור הזהב - עבודה עם אנרגיה מינית</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'דמיון מודרך כדור הזהב - עבודה עם אנרגיה מינית', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/v_KR3vuczjI" target="_blank">
                            <span>הורמון האהבה - מדיטציה סבלימינלית להעלאת רמת האוקסיטוצין</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'הורמון האהבה - מדיטציה סבלימינלית להעלאת רמת האוקסיטוצין', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/HUL34ZJmZ1o" target="_blank">
                            <span>מדיטציה למיגנוט חבר נשמתי וזוגיות לנשים</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה למיגנוט חבר נשמתי וזוגיות לנשים', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="http://www.meditationlibrary.net/תרגיל-בזימון-זוגיות/" target="_blank">
                            <span>תרגיל בזימון זוגיות</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'תרגיל בזימון זוגיות', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/usyI1Is9b1k" target="_blank">
                            <span>Love Signal 528 Hz</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'Love Signal 528 Hz', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/JJCOozFQ178" target="_blank">
                            <span>פתיחת הלב ומגנוט הגבר של חייך</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'פתיחת הלב ומגנוט הגבר של חייך', event)">○</span>
                    </div>
                </div>
                
                <!-- ריפוי עצמי והחלמה -->
                <div class="meditations-category">
                    <h3>🌱 ריפוי עצמי והחלמה</h3>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://www.meditationlibrary.net/מדיטציה-לניקוי-אנרגטי/" target="_blank">
                            <span>מדיטציה לניקוי התדר האנרגטי</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לניקוי התדר האנרגטי', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://www.meditationlibrary.net/הצהרות-לבריאות-וריפוי/" target="_blank">
                            <span>הצהרות לריפוי ובריאות מושלמת (10 דקות)</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'הצהרות לריפוי ובריאות מושלמת (10 דקות)', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://www.youtube.com/watch?v=RsImAZkQGNg" target="_blank">
                            <span>מדיטציה לריפוי הגוף, בריאות והחלמה</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לריפוי הגוף, בריאות והחלמה', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/uPU4VpPifIc?si=7nijPAsdscZQLDdp" target="_blank">
                            <span>מדיטציית ריפוי, החלמה, רוגע ובריאות פירמידה של החלמה</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציית ריפוי, החלמה, רוגע ובריאות פירמידה של החלמה', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://www.youtube.com/watch?v=NpstQxsXPEI" target="_blank">
                            <span>מדיטציית החלמה וריפוי מפציעות בגוף-נפש (שעה ו-11 דקות)</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציית החלמה וריפוי מפציעות בגוף-נפש (שעה ו-11 דקות)', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/Wa1GEKagrHU?si=tiaBjKiAw_CsKF4k" target="_blank">
                            <span>מדיטציה לחיזוק הגוף, מערכת החיסון והתאוששות ממחלה</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לחיזוק הגוף, מערכת החיסון והתאוששות ממחלה', event)">○</span>
                    </div>
                </div>
                
                <!-- חיוניות ואנרגיה חיובית -->
                <div class="meditations-category">
                    <h3>☀️ חיוניות ואנרגיה חיובית</h3>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/ML4eMxWkFGU" target="_blank">
                            <span>מדיטציה לחשיבה חיובית ואנרגיה חיובית ב-6 דקות</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לחשיבה חיובית ואנרגיה חיובית ב-6 דקות', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/MU3Ic2dp3uw?si=7leq-EtdHa9SKpg8" target="_blank">
                            <span>מדיטציה לחשיבה חיובית, הכרת תודה שמחה ואופטימיות</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לחשיבה חיובית, הכרת תודה שמחה ואופטימיות', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/HTB5GDRjuwk?si=OUbN-Vi-MsRa39nS" target="_blank">
                            <span>מדיטציה לחיזוק חשיבה חיובית העצמת הביטחון והשפע</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לחיזוק חשיבה חיובית העצמת הביטחון והשפע', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/ztxpPqkwQVg" target="_blank">
                            <span>זריקת מרץ ואנרגיה - אימון גלי מוח</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'זריקת מרץ ואנרגיה - אימון גלי מוח', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://www.youtube.com/watch?v=YJGbi2cLzak" target="_blank">
                            <span>מדיטציה לבוקר טוב עם אנרגיות חיוביות</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לבוקר טוב עם אנרגיות חיוביות', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/PamCP6LzAag?si=RtxVK3I2re6IhKP9" target="_blank">
                            <span>לסדר את הבוקר ולהתחיל את היום עם חיוך ומוטיבציה</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'לסדר את הבוקר ולהתחיל את היום עם חיוך ומוטיבציה', event)">○</span>
                    </div>
                </div>
                
                <!-- שינוי והתפתחות אישית -->
                <div class="meditations-category">
                    <h3>💫 שינוי והתפתחות אישית</h3>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/PcV2_5a8xqs" target="_blank">
                            <span>דמיון מודרך הכנה לקראת שינוי - פרק א'</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'דמיון מודרך הכנה לקראת שינוי - פרק א\'', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/5ifOK-YsL0Q" target="_blank">
                            <span>דמיון מודרך לשינוי פרק ב'</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'דמיון מודרך לשינוי פרק ב\'', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://www.youtube.com/watch?v=MKlAN8e1GAY" target="_blank">
                            <span>מדיטציה ליצירת עתיד והפעלת כוחו של התת מודע ליצירת מציאות</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה ליצירת עתיד והפעלת כוחו של התת מודע ליצירת מציאות', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/kXjIm3nQido?si=LboGG_7H3VeVjug-" target="_blank">
                            <span>מדיטציה לשנה החדשה</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לשנה החדשה', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/kLaX9fpgV44?si=5tiTMsx9EKDSKdFE" target="_blank">
                            <span>מדיטציה לבניית האני העתידית</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לבניית האני העתידית', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/ekJ8Yq6xoog?si=0NmIIOFmPzriqOOB" target="_blank">
                            <span>מדיטציה להגשמה – חוק המשיכה בפועלה</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה להגשמה – חוק המשיכה בפועלה', event)">○</span>
                    </div>
                </div>
                
                <!-- שונות -->
                <div class="meditations-category">
                    <h3>🌈 שונות</h3>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/Qwzv0EfiY-k?si=YB5GaI6Zyqjp-GIs" target="_blank">
                            <span>מדיטציית שפע כלכלי למשיכת כסף ,מזל ועושר</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציית שפע כלכלי למשיכת כסף ,מזל ועושר', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/0asyM8q8DPA?si=vud7gwWZzJRpTwxh" target="_blank">
                            <span>מדיטציה לשיפור הריכוז הזיכרון</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לשיפור הריכוז הזיכרון', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/mB894cMo9Xg?si=QzfGQ0KI3VZdTBYw" target="_blank">
                            <span>מדיטציה לזמן מלחמה</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'מדיטציה לזמן מלחמה', event)">○</span>
                    </div>
                    <div class="meditations-link-container">
                        <a class="meditations-link" href="https://youtu.be/BZmCeIbp7UY?si=Dx10oSZMms3gAThi" target="_blank">
                            <span>התמודדות עם אובדן ושכול</span>
                        </a>
                        <span class="favorite-circle" onclick="toggleFavorite(this, 'התמודדות עם אובדן ושכול', event)">○</span>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 15px; background: #d4e5da; border-radius: 10px; text-align: center;">
                    <strong style="color: #8cb89c;">🙏</strong> אוסף המדיטציות שלנו נאסף בקפידה מרחבי הרשת, אנו מודות מכל הלב לכל היוצרים והיוצרות שנותנים לנו השראה ומעשירים את עולמנו
                </div>
                
            </div>
        </div>
    </div>

    <!-- Emotions Reference Modal -->
    <div id="emotionsModal" class="reference-modal">
        <div class="reference-content">
            <span class="close" onclick="closeEmotionsReference()" style="position: absolute; top: 15px; left: 25px;">&times;</span>
            <h2 style="margin-bottom: 15px; color: #4a5568;">רשימת רגשות</h2>
            <div style="text-align: right; line-height: 2; padding: 15px; background: #f9f9f9; border-radius: 15px; max-height: 70vh; overflow-y: auto;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div>
                        <h3 style="color: #C86F7B; margin-bottom: 10px;">💝 חמלה</h3>
                        <p>חיבה, ידידות, חברות, הזדהות, רוך, חום, פתיחות, אהבה</p>
                    </div>
                    <div>
                        <h3 style="color: #8cb89c; margin-bottom: 10px;">💪 ביטחון</h3>
                        <p>חיזוק, העצמה, עידוד, גאווה, תקווה</p>
                    </div>
                    <div>
                        <h3 style="color: #D4B896; margin-bottom: 10px;">⚡ חיות</h3>
                        <p>ברכה, קורן, התפעמות, תדהמה, התרגשות, התלהבות, להיטות, מרץ, השתוקקות, פעלתנות</p>
                    </div>
                    <div>
                        <h3 style="color: #8cb89c; margin-bottom: 10px;">😌 רוגע</h3>
                        <p>אמון, קבלה, חיבור, נחת, מימוש, הגשמה, סיפוק, עדינות, נינוחות, שלווה, בהירות, נועם, שוויון נפש, שקט, שביעות רצון</p>
                    </div>
                    <div>
                        <h3 style="color: #B8A9D9; margin-bottom: 10px;">😊 שמחה</h3>
                        <p>עליזות, הנאה, שעשוע, אושר, עונג</p>
                    </div>
                    <div>
                        <h3 style="color: #8cb89c; margin-bottom: 10px;">🌱 רעננות</h3>
                        <p>ערנות, חיות מחודשת, שיקום, מלאות מחודשת, צלילות דעת</p>
                    </div>
                    <div>
                        <h3 style="color: #D4B896; margin-bottom: 10px;">🙏 הודיה</h3>
                        <p>הארה, הכרת תודה, אופטימיות, חיוביות</p>
                    </div>
                    <div>
                        <h3 style="color: #8cb89c; margin-bottom: 10px;">🔍 סקרנות</h3>
                        <p>שילהוב, עניין, מעורבות, השראה, להט</p>
                    </div>
                    <div>
                        <h3 style="color: #667eea; margin-bottom: 10px;">😕 בלבול</h3>
                        <p>פיצול, קריעה, אובדן דרך, בלבול, מבוכה, אובדן עצות, פיזור דעת, התפזרות, הסחת דעת</p>
                    </div>
                    <div>
                        <h3 style="color: #f56565; margin-bottom: 10px;">😰 פחד</h3>
                        <p>חשש, חשדנות, בהלה, פאניקה, בעתה, אימה, שיתוק, דאגה, טרדה</p>
                    </div>
                    <div>
                        <h3 style="color: #C86F7B; margin-bottom: 10px;">💔 כאב</h3>
                        <p>ייסורים, הרס, שברון, חרטה, ייסורי מצפון, אשמה, תהפוכה, מהומה, פגיעות</p>
                    </div>
                    <div>
                        <h3 style="color: #e53e3e; margin-bottom: 10px;">😠 שנאה</h3>
                        <p>איבה, טינה, תוקפנות, מרירות, סלידה, דחיה, גועל, בוז</p>
                    </div>
                    <div>
                        <h3 style="color: #a0aec0; margin-bottom: 10px;">😑 שעמום</h3>
                        <p>נתק, ניכור, ריחוק, אפאטיות, קור, סגירות, מופנמות, חוסר סבלנות, פתיל קצר</p>
                    </div>
                    <div>
                        <h3 style="color: #D4B896; margin-bottom: 10px;">😒 קנאה</h3>
                        <p>רכושנות</p>
                    </div>
                    <div>
                        <h3 style="color: #718096; margin-bottom: 10px;">😫 עייפות</h3>
                        <p>הצפה, התשה, אפיסת כוחות, נמנום, לאות, תשישות</p>
                    </div>
                    <div>
                        <h3 style="color: #f6ad55; margin-bottom: 10px;">😬 אי נוחות</h3>
                        <p>רטינה, זעזוע, הלם, הפתעה, דריכות, אי נחת, ערעור, חוסר מנוחה, חוסר ודאות, חוסר שקט</p>
                    </div>
                    <div>
                        <h3 style="color: #ed8936; margin-bottom: 10px;">😤 עצבנות</h3>
                        <p>חוסר סיפוק, זעף, תסכול, חוסר סבלנות, טרדה</p>
                    </div>
                    <div>
                        <h3 style="color: #5a67d8; margin-bottom: 10px;">😢 עצבות</h3>
                        <p>מעורר רחמים, כמיהה, נואשות, חוסר ישע, חוסר תקווה, געגוע, לב כבד, אכזבה, ייאוש, מלנכוליה, דיכאון, דכדוך, קדרות</p>
                    </div>
                    <div>
                        <h3 style="color: #f687b3; margin-bottom: 10px;">😳 מבוכה</h3>
                        <p>בושה, ביישנות, פגיעות, שבריריות, חוסר ביטחון, איפוק, ריסון</p>
                    </div>
                    <div>
                        <h3 style="color: #9f7aea; margin-bottom: 10px;">🤒 תחושות גוף</h3>
                        <p>כיווץ, חולי, חולשה, ריקנות, חנק, כאב, מתח, לחץ, רעד, חוסר נשימה, סחוט</p>
                    </div>
                </div>
                <div style="margin-top: 30px; padding: 15px; background: #d4e5da; border-radius: 10px; text-align: center;">
                    <strong style="color: #8cb89c;">💡 טיפ:</strong> נסי לזהות בדיוק איזה רגש את חווה - זה יעזור לך להבין מה את צריכה כרגע
                </div>
            </div>
        </div>
    </div>

    <!-- New Emotions Side Panel -->
    <div id="emotionsSidePanel" class="emotions-side-panel">
        <div class="emotions-panel-content">
            <div class="emotions-panel-header">
                <h2>רשימת רגשות</h2>
                <button class="emotions-close-btn" onclick="closeEmotionsSidePanel()">×</button>
            </div>
            <div class="emotions-panel-body">
                <div style="text-align: right; line-height: 2;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div>
                            <h3 style="color: #C86F7B; margin-bottom: 10px;">💝 חמלה</h3>
                            <p>חיבה, ידידות, חברות, הזדהות, רוך, חום, פתיחות, אהבה</p>
                        </div>
                        <div>
                            <h3 style="color: #8cb89c; margin-bottom: 10px;">💪 ביטחון</h3>
                            <p>חיזוק, העצמה, עידוד, גאווה, תקווה</p>
                        </div>
                        <div>
                            <h3 style="color: #D4B896; margin-bottom: 10px;">⚡ חיות</h3>
                            <p>ברכה, קורן, התפעמות, תדהמה, התרגשות, התלהבות, להיטות, מרץ, השתוקקות, פעלתנות</p>
                        </div>
                        <div>
                            <h3 style="color: #8cb89c; margin-bottom: 10px;">😌 רוגע</h3>
                            <p>אמון, קבלה, חיבור, נחת, מימוש, הגשמה, סיפוק, עדינות, נינוחות, שלווה, בהירות, נועם, שוויון נפש, שקט, שביעות רצון</p>
                        </div>
                        <div>
                            <h3 style="color: #B8A9D9; margin-bottom: 10px;">😊 שמחה</h3>
                            <p>עליזות, הנאה, שעשוע, אושר, עונג</p>
                        </div>
                        <div>
                            <h3 style="color: #8cb89c; margin-bottom: 10px;">🌱 רעננות</h3>
                            <p>ערנות, חיות מחודשת, שיקום, מלאות מחודשת, צלילות דעת</p>
                        </div>
                        <div>
                            <h3 style="color: #D4B896; margin-bottom: 10px;">🙏 הודיה</h3>
                            <p>הארה, הכרת תודה, אופטימיות, חיוביות</p>
                        </div>
                        <div>
                            <h3 style="color: #8cb89c; margin-bottom: 10px;">🔍 סקרנות</h3>
                            <p>שילהוב, עניין, מעורבות, השראה, להט</p>
                        </div>
                        <div>
                            <h3 style="color: #667eea; margin-bottom: 10px;">😕 בלבול</h3>
                            <p>פיצול, קריעה, אובדן דרך, בלבול, מבוכה, אובדן עצות, פיזור דעת, התפזרות, הסחת דעת</p>
                        </div>
                        <div>
                            <h3 style="color: #8cb89c; margin-bottom: 10px;">😰 פחד</h3>
                            <p>חשש, חשדנות, בהלה, פאניקה, בעתה, אימה, שיתוק, דאגה, טרדה</p>
                        </div>
                        <div>
                            <h3 style="color: #C86F7B; margin-bottom: 10px;">💔 כאב</h3>
                            <p>ייסורים, הרס, שברון, חרטה, ייסורי מצפון, אשמה, תהפוכה, מהומה, פגיעות</p>
                        </div>
                        <div>
                            <h3 style="color: #e53e3e; margin-bottom: 10px;">😠 שנאה</h3>
                            <p>איבה, טינה, תוקפנות, מרירות, סלידה, דחיה, גועל, בוז</p>
                        </div>
                        <div>
                            <h3 style="color: #a0aec0; margin-bottom: 10px;">😑 שעמום</h3>
                            <p>נתק, ניכור, ריחוק, אפאטיות, קור, סגירות, מופנמות, חוסר סבלנות, פתיל קצר</p>
                        </div>
                        <div>
                            <h3 style="color: #D4B896; margin-bottom: 10px;">😒 קנאה</h3>
                            <p>רכושנות</p>
                        </div>
                        <div>
                            <h3 style="color: #718096; margin-bottom: 10px;">😫 עייפות</h3>
                            <p>הצפה, התשה, אפיסת כוחות, נמנום, לאות, תשישות</p>
                        </div>
                        <div>
                            <h3 style="color: #f6ad55; margin-bottom: 10px;">😬 אי נוחות</h3>
                            <p>רטינה, זעזוע, הלם, הפתעה, דריכות, אי נחת, ערעור, חוסר מנוחה, חוסר ודאות, חוסר שקט</p>
                        </div>
                        <div>
                            <h3 style="color: #ed8936; margin-bottom: 10px;">😤 עצבנות</h3>
                            <p>חוסר סיפוק, זעף, תסכול, חוסר סבלנות, טרדה</p>
                        </div>
                        <div>
                            <h3 style="color: #5a67d8; margin-bottom: 10px;">😢 עצבות</h3>
                            <p>מעורר רחמים, כמיהה, נואשות, חוסר ישע, חוסר תקווה, געגוע, לב כבד, אכזבה, ייאוש, מלנכוליה, דיכאון, דכדוך, קדרות</p>
                        </div>
                        <div>
                            <h3 style="color: #f687b3; margin-bottom: 10px;">😳 מבוכה</h3>
                            <p>בושה, ביישנות, פגיעות, שבריריות, חוסר ביטחון, איפוק, ריסון</p>
                        </div>
                        <div>
                            <h3 style="color: #9f7aea; margin-bottom: 10px;">🤒 תחושות גוף</h3>
                            <p>כיווץ, חולי, חולשה, ריקנות, חנק, כאב, מתח, לחץ, רעד, חוסר נשימה, סחוט</p>
                        </div>
                    </div>
                    <div style="margin-top: 30px; padding: 15px; background: #d4e5da; border-radius: 10px; text-align: center;">
                        <strong style="color: #4a5568;">💡 טיפ:</strong> נסי לזהות בדיוק איזה רגש את חווה - זה יעזור לך להבין מה את צריכה כרגע
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Needs Reference Modal -->
    <div id="needsModal" class="reference-modal">
        <div class="reference-content">
            <span class="close" onclick="closeNeedsReference()" style="position: absolute; top: 15px; left: 25px;">&times;</span>
            <h2 style="margin-bottom: 15px; color: #4a5568;">רשימת צרכים</h2>
            <div style="text-align: right; line-height: 2; padding: 15px; background: #f9f9f9; border-radius: 15px; max-height: 70vh; overflow-y: auto;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                    <div>
                        <h3 style="color: #8cb89c; margin-bottom: 10px;">🦅 חופש</h3>
                        <p>עצמאות, זמן, מרחב, חופש בחירה, אוטונומיה</p>
                    </div>
                    <div>
                        <h3 style="color: #C86F7B; margin-bottom: 10px;">🤍 כנות</h3>
                        <p>שקיפות, יושרה, אותנטיות, אמיתיות</p>
                    </div>
                    <div>
                        <h3 style="color: #D4B896; margin-bottom: 10px;">🤸‍♀️ משחק / חוויות מגוונות</h3>
                        <p>רב־גוניות, חוויות, קלילות, ספונטניות, הרפתקנות, פנטזיה, ויזואליות, חקר, הומור, גיוון, כיף, צחוק, גילוי, חיות, זרימה, חגיגה</p>
                    </div>
                    <div>
                        <h3 style="color: #B8A9D9; margin-bottom: 10px;">✨ תחושת משמעות</h3>
                        <p>פשטות, רוחניות, מיקוד פנימי, נוכחות, יש לי מקום בעולם, לקחת חלק, להילקח בחשבון, להיות בעל חשיבות, שינוי צורה, התמרה, שחרור, מודעות, ערנות, בהירות, ביטוי, יכולת השפעה, יעילות, התפתחות, גדילה, התקדמות, צמיחה, דרבון, אתגר, השראה, למידה, יצירתיות, העצמה, יכולת, מסגולות, עוצמה, כוח, חוסן פנימי, כבוד עצמי, ביטחון עצמי, ערך עצמי, אמונה, העשרת החיים, תקווה, תכלית, תהליך, תרומה</p>
                    </div>
                    <div>
                        <h3 style="color: #C86F7B; margin-bottom: 10px;">💞 חיבור</h3>
                        <p>אדיבות, רגישות, רכות, עדינות, קבלה, הכלה, נתינה, לחלוק, להיות מובן (הבנה), להבין, להישמע (הקשבה), לשמוע, להיראות (נראות), לראות, ידיעה, עזרה, תמיכה, הזנה, המשכיות, עקביות, כבוד, הדדיות, השתתפות, להיות חלק, הכללה, שותפות, רעות, ידידות, חברות, קהילה, שייכות, פתיחות, אמון, שיתוף פעולה, שיתופיות, תקשורת, תשומת לב, הכרה, הערכה, חיבה, אישור, עידוד, אמפתיה, חמלה, אינטימיות, קרבה, אהבה, טיפוח, אכפתיות</p>
                    </div>
                    <div>
                        <h3 style="color: #8cb89c; margin-bottom: 10px;">🏃‍♀️ חוויה גופנית</h3>
                        <p>מגע, שינה, ביטחון פיזי, מנוחה, אימון גופני, תנועה, המשכיות, ביטחון רגשי, הגנה מפני כאב, בטיחות, הגנה, אבטחה, מחסה, אור, מים, מזון, אוויר</p>
                    </div>
                    <div>
                        <h3 style="color: #D4B896; margin-bottom: 10px;">⚖️ הרמוניה</h3>
                        <p>הוגנות, שוויון, איזון, יציבות, ודאות, אינטגרציה, עיכול, שלמות, אחווה, אחדות, סדר, יופי, קלילות, שלווה, הרפיה, רוגע, השלמה, שלום</p>
                    </div>
                </div>
                <div style="margin-top: 30px; padding: 15px; background: #d4e5da; border-radius: 10px; text-align: center;">
                    <strong style="color: #4a5568;">💡 חשוב לזכור:</strong> כל הצרכים שלנו תקפים וחשובים. הרגש שלנו מצביע על צרכים שמתמלאים או לא מתמלאים
                </div>
            </div>
        </div>
    </div>

    <!-- New Needs Side Panel -->
    <div id="needsSidePanel" class="needs-side-panel">
        <div class="needs-panel-content">
            <div class="needs-panel-header">
                <h2>רשימת צרכים</h2>
                <button class="needs-close-btn" onclick="closeNeedsSidePanel()">×</button>
            </div>
            <div class="needs-panel-body">
                <div style="text-align: right; line-height: 2;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div>
                            <h3 style="color: #8cb89c; margin-bottom: 10px;">🦅 חופש</h3>
                            <p>עצמאות, זמן, מרחב, חופש בחירה, אוטונומיה</p>
                        </div>
                        <div>
                            <h3 style="color: #C86F7B; margin-bottom: 10px;">🤍 כנות</h3>
                            <p>שקיפות, יושרה, אותנטיות, אמיתיות</p>
                        </div>
                        <div>
                            <h3 style="color: #D4B896; margin-bottom: 10px;">🤸‍♀️ משחק / חוויות מגוונות</h3>
                            <p>רב־גוניות, חוויות, קלילות, ספונטניות, הרפתקנות, פנטזיה, ויזואליות, חקר, הומור, גיוון, כיף, צחוק, גילוי, חיות, זרימה, חגיגה</p>
                        </div>
                        <div>
                            <h3 style="color: #B8A9D9; margin-bottom: 10px;">✨ תחושת משמעות</h3>
                            <p>פשטות, רוחניות, מיקוד פנימי, נוכחות, יש לי מקום בעולם, לקחת חלק, להילקח בחשבון, להיות בעל חשיבות, שינוי צורה, התמרה, שחרור, מודעות, ערנות, בהירות, ביטוי, יכולת השפעה, יעילות, התפתחות, גדילה, התקדמות, צמיחה, דרבון, אתגר, השראה, למידה, יצירתיות, העצמה, יכולת, מסגולות, עוצמה, כוח, חוסן פנימי, כבוד עצמי, ביטחון עצמי, ערך עצמי, אמונה, העשרת החיים, תקווה, תכלית, תהליך, תרומה</p>
                        </div>
                        <div>
                            <h3 style="color: #C86F7B; margin-bottom: 10px;">💞 חיבור</h3>
                            <p>אדיבות, רגישות, רכות, עדינות, קבלה, הכלה, נתינה, לחלוק, להיות מובן (הבנה), להבין, להישמע (הקשבה), לשמוע, להיראות (נראות), לראות, ידיעה, עזרה, תמיכה, הזנה, המשכיות, עקביות, כבוד, הדדיות, השתתפות, להיות חלק, הכללה, שותפות, רעות, ידידות, חברות, קהילה, שייכות, פתיחות, אמון, שיתוף פעולה, שיתופיות, תקשורת, תשומת לב, הכרה, הערכה, חיבה, אישור, עידוד, אמפתיה, חמלה, אינטימיות, קרבה, אהבה, טיפוח, אכפתיות</p>
                        </div>
                        <div>
                            <h3 style="color: #8cb89c; margin-bottom: 10px;">🏃‍♀️ חוויה גופנית</h3>
                            <p>מגע, שינה, ביטחון פיזי, מנוחה, אימון גופני, תנועה, המשכיות, ביטחון רגשי, הגנה מפני כאב, בטיחות, הגנה, אבטחה, מחסה, אור, מים, מזון, אוויר</p>
                        </div>
                        <div>
                            <h3 style="color: #D4B896; margin-bottom: 10px;">⚖️ הרמוניה</h3>
                            <p>הוגנות, שוויון, איזון, יציבות, ודאות, אינטגרציה, עיכול, שלמות, אחווה, אחדות, סדר, יופי, קלילות, שלווה, הרפיה, רוגע, השלמה, שלום</p>
                        </div>
                    </div>
                    <div style="margin-top: 30px; padding: 15px; background: #d4e5da; border-radius: 10px; text-align: center;">
                        <strong style="color: #4a5568;">💡 חשוב לזכור:</strong> כל הצרכים שלנו תקפים וחשובים. הרגש שלנו מצביע על צרכים שמתמלאים או לא מתמלאים
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PIN Verification Screen -->
    <div id="pinScreen" class="container" style="display: none;">
        <div class="header">
            <h1>🔐 הכנסת סיסמא</h1>
            <p>שלום <span id="pinUsername"></span>, אנא הכניסי את הסיסמא שלך</p>
        </div>
        
        <div style="max-width: 300px; margin: 0 auto; text-align: center;">
            <div class="pin-section">
                <input type="password" id="pinVerification" class="pin-input" placeholder="****" maxlength="8" pattern="[0-9]{4,8}">
                <br>
                <button class="save-btn" onclick="verifyPin()" style="margin-top: 20px;">
                    ✅ כניסה
                </button>
                <br>
                <button class="nav-btn" onclick="backToLogin()" style="margin-top: 10px;">
                    ← חזור
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main App -->
    <div id="mainApp" class="container" style="display: none;">
        <div class="header">
            <!-- Logo for main app -->
            <img id="mainAppLogo" 
                 src="logo.png" 
                 alt="אל עצמי - מסע של הקשבה והתרחבות הלב" 
                 style="max-width: 300px; width: 60%; height: auto; margin: 0 auto 20px; display: block;"
                 onerror="this.style.display='none';">
            <p><span style="color: #C86F7B; font-weight: bold;">שלום <span id="currentUser"></span>!</span> 💜</p>
            <div class="header-actions">
                <button class="hamburger" aria-label="תפריט" onclick="openMenu()">☰</button>
            </div>
            <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleFileImport(this)">
        </div>
        
        <div style="text-align: center; margin-bottom: 20px;">
            <p class="calendar-hint">בחרי יום וקחי רגע קט — להתקרב אל עצמך</p>
            <div class="month-year" id="monthYear" style="font-size: 2em; font-weight: 700; color: #737373; margin-bottom: 6px;"></div>
            <div class="calendar-nav" style="display: flex; justify-content: center; gap: 15px;">
                <button class="nav-btn" onclick="changeMonth(-1)">→ חודש קודם</button>
                <button class="nav-btn" onclick="goToToday()">היום</button>
                <button class="nav-btn" onclick="changeMonth(1)">חודש הבא ←</button>
            </div>
        </div>
        
        <div class="calendar" id="calendar"></div>
    </div>

    <!-- Side menu elements -->
    <div class="menu-overlay" id="menuOverlay" onclick="closeMenu()"></div>
    <nav class="side-menu" id="sideMenu" role="navigation" aria-label="תפריט צד">
        <button class="menu-close" aria-label="סגור תפריט" onclick="closeMenu()">×</button>
        <ul class="menu-list">
            <li><button class="menu-item" onclick="exportData(); closeMenu()">💾 שמירה</button></li>
            <li><button class="menu-item" onclick="exportToExcel(); closeMenu()">📊 ייצוא לאקסל</button></li>
            <li><button class="menu-item" onclick="importData(); closeMenu()">📂 שחזור</button></li>
            <hr class="menu-divider" />
            <li><button class="menu-item" onclick="showHelp(); closeMenu()">❓ עזרה</button></li>
            <li><button class="menu-item" onclick="logout(); closeMenu()">🚪 התנתקות</button></li>
        </ul>
    </nav>
    
    <div id="dayModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalDate"></h2>
            
            <div class="section" id="moodSection">
                <div class="section-header">
                    <h3>🎭 איך אני מרגישה עכשיו?</h3>
                </div>
                <div class="mood-selector">
                    <button class="mood-btn" data-mood="😊">😊 שמחה</button>
                    <button class="mood-btn" data-mood="😌">😌 רוגע</button>
                    <button class="mood-btn" data-mood="💝">💝 חמלה</button>
                    <button class="mood-btn" data-mood="😢">😢 עצבות</button>
                    <button class="mood-btn" data-mood="😰">😰 פחד</button>
                    <button class="mood-btn" data-mood="😤">😤 עצבנות</button>
                    <button class="mood-btn" data-mood="😫">😫 עייפות</button>
                    <button class="mood-btn" data-mood="😕">😕 בלבול</button>
                    <button class="mood-btn" data-mood="⚡">⚡ חיות</button>
                    <button class="mood-btn" data-mood="💪">💪 ביטחון</button>
                </div>
                <textarea id="feelings" placeholder="מה עובר לי בראש? איך הגוף שלי מרגיש?"></textarea>
            </div>
            
            <div class="section" id="gratitudeSection">
                <div class="section-header">
                <h3>💝 הכרת תודה</h3>
                </div>
                <p style="margin-bottom: 10px; color: #666; font-size: 19px;">רשמי שלושה דברים ששימחו, ריגשו או גרמו לך להרגשה טובה. זכרי להודות גם לעצמך!</p>
                <textarea id="gratitude" placeholder="1. משהו שהיה טוב היום...&#10;2. משהו שאני מעריכה בעצמי...&#10;3. מישהו או משהו שאני אסירת תודה עליו..."></textarea>
            </div>
            
            <div class="section collapsed" id="breathingSection">
                <div class="section-toggle" onclick="toggleSection('breathingSection')">
                    <h3>🫁 רגע של נשימה</h3>
                </div>
                <div class="section-content">
                    <div class="breathing-exercise">
                        <div class="breathing-circle" id="breathingCircle">נשימה עמוקה</div>
                        <div style="margin-top: 25px;">
                            <button class="nav-btn breathing-btn" onclick="startBreathing()">התחלת תרגיל</button>
                            <p style="margin-top: 8px; color: #8cb89c; font-size: 17px; font-weight: 500;">טכניקת 4-7-8 להרגעות</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section collapsed" id="meditationSection">
                <div class="section-toggle" onclick="toggleSection('meditationSection')">
                    <h3>🧘‍♀️ רגע של מדיטציה</h3>
                </div>
                <div class="section-content">
                    <p style="margin-bottom: 10px; color: #666; font-size: 19px;">
                        כאן תמצאי מגוון מדיטציות שיעזרו לך לעצור לרגע, לנשום ולהתחבר לעצמך. 
                        פשוט בחרי את מה שמתאים לך עכשיו ותני לעצמך רגע של שקט ורוגע.
                    </p>
                    <button class="meditation-btn" onclick="showMeditationsLibrary()">
                        🎧 אוסף מדיטציות
                    </button>
                    <textarea id="meditationNotes" placeholder="זו הזדמנות בשבילי להקשיב פנימה ולכתוב לעצמי בכנות, גם אם אלו רק מילים בודדות" style="margin-top: 10px; min-height: 80px;"></textarea>
                </div>
            </div>
            
            <div class="support-message" id="supportMessage">
                <div class="quote-content">
                    <span class="quote-symbol">❞</span>
                    💫 אני ראויה לאהבה ולכבוד - מעצמי ומאחרים
                    <span class="quote-symbol">❝</span>
                </div>
            </div>
            
            <div class="section analysis-section collapsed" id="cnvcSection">
                <div class="section-toggle" onclick="toggleSection('cnvcSection')">
                    <h3>💬 ניתוח סיטואציה – מודל תקשורת מקרבת</h3>
                </div>
                <div class="section-content">
                    <p style="margin-bottom: 12px; color: #666; font-size: 19px;">מודל CNVC (תקשורת מקרבת) לניתוח מצבים רגשיים</p>
                    
                    <div style="background: white; padding: 12px; border-radius: 10px; margin-bottom: 8px;">
                        <h4 style="color: #8cb89c; margin-bottom: 10px;">🔍 תצפית</h4>
                        <p style="font-size: 19.5px; color: #666; margin-bottom: 10px;"> תארי את הסיטואציה שקרתה, בלי פרשנות או שיפוט.</p>
                        <textarea id="observation" placeholder="מה בדיוק קרה? תיאור עובדתי..."></textarea>
                    </div>
                    
                    <div style="background: white; padding: 12px; border-radius: 10px; margin-bottom: 8px;">
                        <div class="section-header">
                            <h4 style="color: #8cb89c; margin: 0;">💙 רגש</h4>
                            <button class="reference-btn" onclick="showEmotionsReference()">רשימת רגשות</button>
                        </div>
                        <p style="font-size: 19.5px; color: #666; margin-bottom: 10px;"> אילו רגשות עולים בך? בחרי מרשימת הרגשות.</p>
                        <textarea id="feeling" placeholder="אני מרגישה... (כועסת, מוטרדת, מאוכזבת וכו')"></textarea>
                    </div>
                    
                    <div style="background: white; padding: 12px; border-radius: 10px; margin-bottom: 8px;">
                        <div class="section-header">
                            <h4 style="color: #8cb89c; margin: 0;">🎯 צורך</h4>
                            <button class="reference-btn" onclick="showNeedsReference()">רשימת צרכים</button>
                        </div>
                        <p style="font-size: 19.5px; color: #666; margin-bottom: 10px;"> אילו צרכים מסתתרים מאחורי הרגש הזה? בחרי מרשימת הצרכים.</p>
                        <textarea id="need" placeholder="אני צריכה... (כבוד, הבנה, ביטחון, סדר וכו')"></textarea>
                    </div>
                    
                    <div style="background: white; padding: 12px; border-radius: 10px; margin-bottom: 8px;">
                        <h4 style="color: #8cb89c; margin-bottom: 10px;">🙏 בקשה</h4>
                        <p style="font-size: 19.5px; color: #666; margin-bottom: 10px;"> כתבי בצורה ברורה, ספציפית וחיובית מה את מבקשת. הניסוח צריך להיות שאלה ולא דרישה או אולטימטום.</p>
                        <textarea id="request" placeholder="האם תוכלי בבקשה...? / האם אפשר...?"></textarea>
                        <div style="background: #f0f8ff; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 17px; color: #666;">
                            <strong>💡 דוגמה:</strong><br>
                            <em>"כשלקחת את הטלפון שלי בלי לשאול (תצפית) הרגשתי מתוסכלת ומאוכזבת (רגש) כי חשוב לי לקבל התחשבות והסכמה לפני שמשתמשים בדברים שלי (צורך). האם תוכלי בבקשה לשאול אותי מראש לפני שאת משתמשת בטלפון שלי? (בקשה)"</em>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section collapsed" id="patternsSection">
                <div class="section-toggle" onclick="toggleSection('patternsSection')">
                    <h3>🔍 זיהוי דפוסים רגשיים - תיאוריית זיהוי תבניות</h3>
                </div>
                <div class="section-content">
                    <h4 style="color: #667eea; margin-bottom: 15px;">אני עוצרת רגע לבדוק עם עצמי - האם זה קורה לי שוב?</h4>
                    
                    <div style="margin-bottom: 8px;">
                        <label style="display: block; font-weight: bold; color: #4a5568; margin-bottom: 8px;">איך הגבתי לסיטואציה הזאת?</label>
                        <textarea id="reaction_response" placeholder="תארי את התגובה שלך..."></textarea>
                    </div>
                    
                    <div style="margin-bottom: 8px;">
                        <label style="display: block; font-weight: bold; color: #4a5568; margin-bottom: 8px;">האם קרה לי משהו דומה בעבר?</label>
                        <textarea id="similar_past" placeholder="האם היו מצבים דומים? מה קרה?"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 8px;">
                        <label style="display: block; font-weight: bold; color: #4a5568; margin-bottom: 8px;">איך אני מרגישה אחרי התגובה שלי?</label>
                        <textarea id="feelings_after" placeholder="מה אני מרגישה כשאני חושבת על איך הגבתי?"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 8px;">
                        <label style="display: block; font-weight: bold; color: #4a5568; margin-bottom: 8px;">האם זה השפיע על הקשרים שלי עם אחרים?</label>
                        <textarea id="impact_relationships" placeholder="איך זה השפיע על הקשרים שלי?"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 8px;">
                        <label style="display: block; font-weight: bold; color: #4a5568; margin-bottom: 8px;">איך אני חושבת שזה השפיע על אנשים שהיו איתי?</label>
                        <textarea id="impact_others" placeholder="מה אני חושבת שהם הרגישו?"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 8px;">
                        <label style="display: block; font-weight: bold; color: #4a5568; margin-bottom: 8px;">מה הייתי רוצה לנסות או לשנות בפעם הבאה?</label>
                        <textarea id="want_to_change" placeholder="איך הייתי רוצה להגיב בפעם הבאה?"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; font-weight: bold; color: #4a5568; margin-bottom: 8px;">מה הצעד הבא שלי? קטן או גדול – כל צעד חשוב!</label>
                        <textarea id="next_step" placeholder="איזה צעד אני יכולה לעשות?"></textarea>
                    </div>
                    
                <div style="background: #F0F8F0; padding: 12px; border-radius: 10px; margin-bottom: 8px; text-align: center;">
                    <p style="color: #8cb89c; font-size: 19px; margin: 0; line-height: 1.6;">
                        💚 <strong>זכרי שכל שינוי לוקח זמן, הרשי לעצמך לטעות וללמוד בדרך שלך.</strong>
                    </p>
                </div>
                    
                    <div style="margin-bottom: 8px;">
                        <label style="display: block; font-weight: bold; color: #4a5568; margin-bottom: 8px;">חזרי לכאן בהמשך כדי לרשום הצלחות או שינויים שהרגשת מאז שעבדת על המודעות הזו:</label>
                        <textarea id="follow_up_progress" placeholder="מה השתנה? איך זה הרגיש?"></textarea>
                    </div>
                </div>
            </div>
            
            <div class="warning-section" style="background: #F9F5E6; border: 2px solid #D4B896; color: #8B7355;">
                <h4 style="color: #8cb89c; margin-bottom: 10px;">💚 מילים של עידוד ותמיכה</h4>
                <p style="margin: 0; line-height: 1.6;">
                    אם את מזהה דפוסים שחוזרים על עצמם או כאב רגשי שלא עובר, זכרי שתמיד אפשר להיעזר באיש מקצוע. 
                    פנייה למטפל או יועץ היא צעד אמיץ וחזק בדרך שלך להרגיש טוב יותר. 💪
                </p>
            </div>
            
            <div class="section">
                <h3>🎯 סימון יום מיוחד</h3>
                <div class="mood-selector">
                    <button class="mood-btn" data-special="significant">✨ יום משמעותי</button>
                    <button class="mood-btn" data-special="review">🔍 יש עוד מה להעמיק</button>
                </div>
            </div>
            
            <button class="save-btn" onclick="saveEntry()">💾 שמור את הרשימה שלי</button>
        </div>
    </div>
    
    <script>
        let currentDate = new Date();
        let selectedDate = null;
        let entries = {};
        let breathingInterval = null;
        let currentUsername = null;
        let userPin = null;
        // Google Sign-In state
        const CLIENT_ID = '779780363006-hpe45dv1db87rrp1il2d2jr17tugbid8.apps.googleusercontent.com';
        const GOOGLE_SCOPES = 'https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email';
        let googleAccessToken = null;
        let googleUser = null;
        
        const supportMessages = [
            "אני ראויה לאהבה ולכבוד - מעצמי ומאחרים",
            "הרגשות שלי תקפים וחשובים",
            "אני לומדת ומתפתחת כל יום",
            "אני חזקה יותר ממה שאני חושבת",
            "זה בסדר לא להיות מושלמת",
            "אני עושה כמיטב יכולתי עם מה שיש לי",
            "קשיים הם הזדמנויות לצמיחה",
            "אני מגלה חמלה כלפי עצמי",
            "אמונה, מעשים טובים וחכמה הם המפתח לרוגע ושלום פנימי",
            "הדרך אינה בשמיים, אלא בלב",
            "הכוח שלך אינו מגיע ממה שקורה לך, אלא מהבחירה שלך כיצד להגיב",
            "השלווה מגיעה מבפנים, אל תחפשי אותה בחוץ",
            "אם ברצונך שאחרים יהיו מאושרים, נהגי בחמלה. אם ברצונך שאת תהיי מאושרת, נהגי בחמלה",
            "דאגה אינה עוזרת. הפני את תשומת לבך מהעתיד אל ההווה",
            "המקור העיקרי לסבל היא ההרגשה שהדברים אינם כפי שהיית רוצה שיהיו",
            "אל תיתני לאחרים להכעיס אותך, או לחלופין, לצפות שהם יהיו המקור לאושרך. זו אחריותך שלך להשיג שקט פנימי",
            "כשאת עוזרת לעצמך את עוזרת לאחרים. הם נהנים מכך שאת שלווה, שמחה, נדיבה ומלאה הערכה על חייך",
            "כאשר את מרגישה אינטימיות עם אנשים, דברים ומצבים, את נפתחת אליהם ומרגישה יותר קרובה אליהם, אפילו אם דבר לא נאמר",
            "אל תבססי את הערכתך העצמית על השוואה לאחרים. חיי מעבר לדברי שבח והימנעי מהאשמות",
            "אם את מרגישה שאת מאבדת את תשומת ליבך עצרי ונשמי נשימות עמוקות",
            "נסי להודות למישהו כל יום",
            "עלינו לבלות חלק מהזמן עם עצמנו",
            "דיבור אוהב והקשבה מלאה הם המפתח לבניית תקשורת",
            "זהי את הדרכים הרבות בהן אנשים מביעים אהבה בלי לומר זאת",
            "להביט בעיניים ולתת את מלוא תשומת הלב שלך היא מתנה גדולה",
            "לתפוס מרחק נפשי מאדם מעליב זה חשוב יותר מאשר לנסות להוכיח את צדקתך",
            "להעניק תשומת לב היא אחד מביטויי האהבה",
            "התאמני להקשיב לאחרים, אינך לומדת שום דבר חדש כשאת מדברת",
            "אם את עושה משהו באותו זמן כל יום, הוא נעשה קל לביצוע וטבעי",
            "האקט של לשחרר משהו הוא חלק משמעותי מהריתמוס של הטבע, וכמוהו גם הלידה מחדש",
            "ברגעים שאינך מתבודדת, הקיפי את עצמך באנשים שמתאימים לערכים שלך",
            "ככל שאנו מבינים טוב יותר את עצמנו כך נבין אחרים",
            "אני מכבדת את מי שאני",
            "עבודה, מנוחה ומשחק הם שלושה דברים שתורמים למרקם חייך",
            "כל יום הוא הזדמנות חדשה"
        ];
        
        const monthNames = [
            'ינואר', 'פברואר', 'מרץ', 'אפריל', 'מאי', 'יוני',
            'יולי', 'אוגוסט', 'ספטמבר', 'אוקטובר', 'נובמבר', 'דצמבר'
        ];
        
        const dayNames = ['א', 'ב', 'ג', 'ד', 'ה', 'ו', 'ש'];
        
        // Reference modal functions
        function showEmotionsReference() {
            const sidePanel = document.getElementById('emotionsSidePanel');
            sidePanel.style.display = 'block';
            // Add active class after a small delay to trigger animation
            setTimeout(() => {
                sidePanel.classList.add('active');
            }, 10);
        }

        // Load Google Identity and API scripts
        function loadGoogleScripts() {
            return new Promise((resolve) => {
                const gsi = document.createElement('script');
                gsi.src = 'https://accounts.google.com/gsi/client';
                gsi.async = true;
                gsi.defer = true;
                gsi.onload = () => {
                    const gapi = document.createElement('script');
                    gapi.src = 'https://apis.google.com/js/api.js';
                    gapi.onload = () => resolve(true);
                    gapi.onerror = () => resolve(false);
                    document.head.appendChild(gapi);
                };
                gsi.onerror = () => resolve(false);
                document.head.appendChild(gsi);
            });
        }

        // Google Sign-In using OAuth2 token client
        async function handleGoogleSignIn() {
            if (typeof google === 'undefined' || !google.accounts?.oauth2) {
                alert('Google Sign-In לא זמין כרגע. נסי שוב בעוד רגע.');
                return;
            }
            try {
                const client = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: GOOGLE_SCOPES,
                    callback: async (resp) => {
                        googleAccessToken = resp.access_token;
                        await getGoogleUserInfo();
                        const displayName = (googleUser && (googleUser.name || googleUser.email)) || 'GoogleUser';
                        const rememberMe = document.getElementById('rememberMeGoogleCheckbox').checked;
                        
                        // Show login success message if remember me is enabled
                        if (rememberMe) {
                            setTimeout(() => {
                                alert(`🎉 התחברת בהצלחה עם Google!\n\n✅ תישארי מחוברת למשך 30 ימים\n\n💡 תוכלי תמיד להתנתק ידנית מהתפריט הצד`);
                            }, 1000);
                        }
                        
                        // Store Google session info
                        if (rememberMe) {
                            const sessionData = {
                                username: displayName,
                                timestamp: Date.now(),
                                expiresAt: Date.now() + (30 * 24 * 60 * 60 * 1000), // 30 days
                                isGoogleUser: true
                            };
                            safeSetItem('loginSession', JSON.stringify(sessionData));
                        }
                        
                        proceedToMainApp(displayName, rememberMe);
                    }
                });
                client.requestAccessToken();
            } catch (e) {
                console.error('Google Sign-In error', e);
                alert('שגיאה בהתחברות ל-Google');
            }
        }

        async function getGoogleUserInfo() {
            if (!googleAccessToken) return;
            try {
                const res = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                    headers: { Authorization: `Bearer ${googleAccessToken}` }
                });
                googleUser = await res.json();
            } catch (e) {
                console.error('Failed fetching Google user info', e);
            }
        }
        
        function closeEmotionsReference() {
            document.getElementById('emotionsModal').style.display = 'none';
        }
        
        function closeEmotionsSidePanel() {
            const sidePanel = document.getElementById('emotionsSidePanel');
            sidePanel.classList.remove('active');
            // Hide panel after animation completes
            setTimeout(() => {
                sidePanel.style.display = 'none';
            }, 300);
        }
        
        function showNeedsReference() {
            const sidePanel = document.getElementById('needsSidePanel');
            sidePanel.style.display = 'block';
            // Add active class after a small delay to trigger animation
            setTimeout(() => {
                sidePanel.classList.add('active');
            }, 10);
        }
        
        function closeNeedsReference() {
            document.getElementById('needsModal').style.display = 'none';
        }
        
        function closeNeedsSidePanel() {
            const sidePanel = document.getElementById('needsSidePanel');
            sidePanel.classList.remove('active');
            // Hide panel after animation completes
            setTimeout(() => {
                sidePanel.style.display = 'none';
            }, 300);
        }
        
        // Section toggle function
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('collapsed');
            
            // Ensure content is always visible when toggling
            const content = section.querySelector('.section-content');
            if (content) {
                if (section.classList.contains('collapsed')) {
                    content.style.display = 'none';
                } else {
                    content.style.display = 'block';
                }
            }
        }
        
        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            const monthYear = document.getElementById('monthYear');
            
            calendar.innerHTML = '';
            monthYear.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            // Add day headers
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-header';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const today = new Date();
            
            for (let i = 0; i < 42; i++) {
                const day = new Date(startDate);
                day.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                if (day.getMonth() !== currentDate.getMonth()) {
                    dayElement.classList.add('other-month');
                }
                
                if (day.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                // Fixed date key generation
                const year = day.getFullYear();
                const month = String(day.getMonth() + 1).padStart(2, '0');
                const dayNum = String(day.getDate()).padStart(2, '0');
                const dateKey = `${year}-${month}-${dayNum}`;
                if (entries[dateKey]) {
                    // Check if there's actual content in the entry
                    const entry = entries[dateKey];
                    const hasContent = entry.feelings || entry.gratitude || entry.observation || 
                                     entry.feeling || entry.need || entry.request || 
                                     entry.reaction_response || entry.similar_past || 
                                     entry.feelings_after || entry.impact_relationships || 
                                     entry.impact_others || entry.want_to_change || 
                                     entry.next_step || entry.follow_up_progress || 
                                     entry.selectedMood;
                    
                    if (hasContent) {
                        dayElement.classList.add('has-entry');
                    }
                    
                    // Add special day icon if exists (without changing color)
                    if (entry.specialDay === 'significant') {
                        const specialIcon = document.createElement('div');
                        specialIcon.className = 'day-special-icon';
                        specialIcon.textContent = '✨';
                        dayElement.appendChild(specialIcon);
                    } else if (entry.specialDay === 'review') {
                        const specialIcon = document.createElement('div');
                        specialIcon.className = 'day-special-icon';
                        specialIcon.textContent = '🔍';
                        dayElement.appendChild(specialIcon);
                    }
                }
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day.getDate();
                
                dayElement.appendChild(dayNumber);
                
                dayElement.addEventListener('click', () => openDay(day));
                calendar.appendChild(dayElement);
            }
        }
        
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            generateCalendar();
        }
        
        function goToToday() {
            currentDate = new Date();
            generateCalendar();
        }
        
        function openDay(date) {
            selectedDate = date;
            const modal = document.getElementById('dayModal');
            const modalDate = document.getElementById('modalDate');
            
            modalDate.textContent = `📅 ${date.getDate()} ${monthNames[date.getMonth()]} ${date.getFullYear()}`;
            
            // Load existing entry if exists - Fixed date key generation
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const dateKey = `${year}-${month}-${day}`;
            const entry = entries[dateKey] || {};
            
            // Load existing entry values safely
            const feelingsEl = document.getElementById('feelings');
            const gratitudeEl = document.getElementById('gratitude');
            const meditationNotesEl = document.getElementById('meditationNotes');
            const observationEl = document.getElementById('observation');
            const feelingEl = document.getElementById('feeling');
            const needEl = document.getElementById('need');
            const requestEl = document.getElementById('request');
            
            // Pattern analysis fields
            const reactionResponseEl = document.getElementById('reaction_response');
            const similarPastEl = document.getElementById('similar_past');
            const feelingsAfterEl = document.getElementById('feelings_after');
            const impactRelationshipsEl = document.getElementById('impact_relationships');
            const impactOthersEl = document.getElementById('impact_others');
            const wantToChangeEl = document.getElementById('want_to_change');
            const nextStepEl = document.getElementById('next_step');
            const followUpProgressEl = document.getElementById('follow_up_progress');
            
            if (feelingsEl) feelingsEl.value = entry.feelings || '';
            if (gratitudeEl) gratitudeEl.value = entry.gratitude || '';
            if (meditationNotesEl) meditationNotesEl.value = entry.meditationNotes || '';
            if (observationEl) observationEl.value = entry.observation || '';
            if (feelingEl) feelingEl.value = entry.feeling || '';
            if (needEl) needEl.value = entry.need || '';
            if (requestEl) requestEl.value = entry.request || '';
            
            // Load pattern analysis fields
            if (reactionResponseEl) reactionResponseEl.value = entry.reaction_response || '';
            if (similarPastEl) similarPastEl.value = entry.similar_past || '';
            if (feelingsAfterEl) feelingsAfterEl.value = entry.feelings_after || '';
            if (impactRelationshipsEl) impactRelationshipsEl.value = entry.impact_relationships || '';
            if (impactOthersEl) impactOthersEl.value = entry.impact_others || '';
            if (wantToChangeEl) wantToChangeEl.value = entry.want_to_change || '';
            if (nextStepEl) nextStepEl.value = entry.next_step || '';
            if (followUpProgressEl) followUpProgressEl.value = entry.follow_up_progress || '';
            
            // Reset mood and special day selection
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (entry.selectedMood && btn.dataset.mood === entry.selectedMood) {
                    btn.classList.add('selected');
                }
                if (btn.dataset.special && entry.specialDay === btn.dataset.special) {
                    btn.classList.add('selected');
                }
            });
            
            // Show random support message
            const supportMessage = document.getElementById('supportMessage');
            const randomMessage = supportMessages[Math.floor(Math.random() * supportMessages.length)];
            supportMessage.innerHTML = `<div class="quote-content"><span class="quote-symbol">❞</span>${randomMessage}<span class="quote-symbol">❝</span></div>`;
            
            // Sections are now open by default
            // No need to add collapsed state
            
            modal.style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('dayModal').style.display = 'none';
            if (breathingInterval) {
                clearInterval(breathingInterval);
                breathingInterval = null;
            }
        }
        
        function saveEntry() {
            if (!selectedDate) return;
            
            // Fixed date key generation
            const year = selectedDate.getFullYear();
            const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
            const day = String(selectedDate.getDate()).padStart(2, '0');
            const dateKey = `${year}-${month}-${day}`;
            const selectedMoodBtn = document.querySelector('.mood-btn[data-mood].selected');
            const selectedSpecialBtn = document.querySelector('.mood-btn[data-special].selected');
            
            // Get values safely
            const feelingsEl = document.getElementById('feelings');
            const gratitudeEl = document.getElementById('gratitude');
            const meditationNotesEl = document.getElementById('meditationNotes');
            const observationEl = document.getElementById('observation');
            const feelingEl = document.getElementById('feeling');
            const needEl = document.getElementById('need');
            const requestEl = document.getElementById('request');
            
            // Pattern analysis fields
            const reactionResponseEl = document.getElementById('reaction_response');
            const similarPastEl = document.getElementById('similar_past');
            const feelingsAfterEl = document.getElementById('feelings_after');
            const impactRelationshipsEl = document.getElementById('impact_relationships');
            const impactOthersEl = document.getElementById('impact_others');
            const wantToChangeEl = document.getElementById('want_to_change');
            const nextStepEl = document.getElementById('next_step');
            const followUpProgressEl = document.getElementById('follow_up_progress');
            
            // Check if there's any content
            const hasContent = 
                (feelingsEl && feelingsEl.value) ||
                (gratitudeEl && gratitudeEl.value) ||
                (meditationNotesEl && meditationNotesEl.value) ||
                (observationEl && observationEl.value) ||
                (feelingEl && feelingEl.value) ||
                (needEl && needEl.value) ||
                (requestEl && requestEl.value) ||
                (reactionResponseEl && reactionResponseEl.value) ||
                (similarPastEl && similarPastEl.value) ||
                (feelingsAfterEl && feelingsAfterEl.value) ||
                (impactRelationshipsEl && impactRelationshipsEl.value) ||
                (impactOthersEl && impactOthersEl.value) ||
                (wantToChangeEl && wantToChangeEl.value) ||
                (nextStepEl && nextStepEl.value) ||
                (followUpProgressEl && followUpProgressEl.value) ||
                selectedMoodBtn ||
                selectedSpecialBtn;
            
            if (!hasContent) {
                // If no content, delete the entry
                delete entries[dateKey];
            } else {
                // Save the entry
                entries[dateKey] = {
                    feelings: feelingsEl ? feelingsEl.value : '',
                    gratitude: gratitudeEl ? gratitudeEl.value : '',
                    meditationNotes: meditationNotesEl ? meditationNotesEl.value : '',
                    observation: observationEl ? observationEl.value : '',
                    feeling: feelingEl ? feelingEl.value : '',
                    need: needEl ? needEl.value : '',
                    request: requestEl ? requestEl.value : '',
                    reaction_response: reactionResponseEl ? reactionResponseEl.value : '',
                    similar_past: similarPastEl ? similarPastEl.value : '',
                    feelings_after: feelingsAfterEl ? feelingsAfterEl.value : '',
                    impact_relationships: impactRelationshipsEl ? impactRelationshipsEl.value : '',
                    impact_others: impactOthersEl ? impactOthersEl.value : '',
                    want_to_change: wantToChangeEl ? wantToChangeEl.value : '',
                    next_step: nextStepEl ? nextStepEl.value : '',
                    follow_up_progress: followUpProgressEl ? followUpProgressEl.value : '',
                    selectedMood: selectedMoodBtn ? selectedMoodBtn.dataset.mood : null,
                    specialDay: selectedSpecialBtn ? selectedSpecialBtn.dataset.special : null,
                    savedAt: new Date().toLocaleDateString('he-IL') + ' ' + new Date().toLocaleTimeString('he-IL')
                };
            }
            
            // Store in user-specific localStorage key
            if (!safeSetItem(getUserDataKey(), JSON.stringify(entries))) {
                // Data will only be saved for this session
            }
            
            generateCalendar();
            closeModal();
            
            if (hasContent) {
                alert('✅ הרשומה נשמרה בהצלחה!');
            } else {
                alert('✅ הרשומה נמחקה (לא היה תוכן)');
            }
        }
        
        function startBreathing() {
            const circle = document.getElementById('breathingCircle');
            const button = event.target;
            let currentPhase = 'inhale'; // inhale, hold, exhale
            let cycleCount = 0;
            let phaseStartTime = Date.now();
            
            // Phase durations in milliseconds
            const inhaleDuration = 4000; // 4 seconds
            const holdDuration = 7000;   // 7 seconds
            const exhaleDuration = 8000; // 8 seconds
            
            if (breathingInterval) {
                clearInterval(breathingInterval);
                breathingInterval = null;
                circle.innerHTML = 'נשימה עמוקה';
                circle.className = 'breathing-circle';
                circle.style.transform = 'scale(1)';
                circle.style.borderWidth = '3px';
                circle.style.boxShadow = '0 0 0 rgba(140, 184, 156, 0)';
                circle.style.background = 'transparent';
                circle.style.removeProperty('--inner-opacity');
                button.textContent = 'התחלת תרגיל';
                return;
            }
            
            button.textContent = 'עצירת תרגיל';
            circle.textContent = 'התכונן...';
            
            setTimeout(() => {
                phaseStartTime = Date.now();
                breathingInterval = setInterval(() => {
                    const currentTime = Date.now();
                    const phaseElapsed = currentTime - phaseStartTime;
                    
                    if (currentPhase === 'inhale') {
                        // Calculate scale from 1 to 1.5 over 4 seconds
                        const progress = Math.min(phaseElapsed / inhaleDuration, 1);
                        const scale = 1 + (progress * 0.5);
                        
                        circle.style.transform = `scale(${scale})`;
                        circle.style.borderWidth = `${3 + (progress * 2)}px`;
                        circle.style.boxShadow = `0 0 ${10 + (progress * 20)}px rgba(140, 184, 156, ${0.3 + (progress * 0.4)})`;
                        circle.style.background = `rgba(140, 184, 156, ${progress * 0.1})`;
                        circle.innerHTML = `שאיפה עמוקה<br>סבב ${cycleCount + 1}/4`;
                        
                        if (phaseElapsed >= inhaleDuration) {
                            currentPhase = 'hold';
                            phaseStartTime = currentTime;
                        }
                    } else if (currentPhase === 'hold') {
                        // Keep scale at 1.5 for 7 seconds
                        
                        circle.style.transform = 'scale(1.5)';
                        circle.style.borderWidth = '5px';
                        circle.style.boxShadow = '0 0 30px rgba(140, 184, 156, 0.7)';
                        circle.style.background = 'rgba(140, 184, 156, 0.1)';
                        circle.innerHTML = `החזקה<br>סבב ${cycleCount + 1}/4`;
                        
                        if (phaseElapsed >= holdDuration) {
                            currentPhase = 'exhale';
                            phaseStartTime = currentTime;
                        }
                    } else if (currentPhase === 'exhale') {
                        // Calculate scale from 1.5 to 1 over 8 seconds
                        const progress = Math.min(phaseElapsed / exhaleDuration, 1);
                        const scale = 1.5 - (progress * 0.5);
                        
                        circle.style.transform = `scale(${scale})`;
                        circle.style.borderWidth = `${5 - (progress * 2)}px`;
                        circle.style.boxShadow = `0 0 ${30 - (progress * 20)}px rgba(140, 184, 156, ${0.7 - (progress * 0.4)})`;
                        circle.style.background = `rgba(140, 184, 156, ${0.1 - (progress * 0.1)})`;
                        circle.innerHTML = `נשיפה<br>סבב ${cycleCount + 1}/4`;
                        
                        if (phaseElapsed >= exhaleDuration) {
                            currentPhase = 'inhale';
                            cycleCount++;
                            phaseStartTime = currentTime;
                            
                            if (cycleCount >= 4) {
                                clearInterval(breathingInterval);
                                breathingInterval = null;
                                circle.innerHTML = 'איך את מרגישה?';
                                circle.className = 'breathing-circle';
                                circle.style.transform = 'scale(1)';
                                circle.style.borderWidth = '3px';
                                circle.style.boxShadow = '0 0 0 rgba(140, 184, 156, 0)';
                                circle.style.background = 'transparent';

                                button.textContent = 'התחלת תרגיל';
                                return;
                            }
                        }
                    }
                }, 50); // Check every 50ms for smoother animations
            }, 1000);
        }
        
        // Safe localStorage wrapper functions
        function safeGetItem(key) {
            try {
                return localStorage ? localStorage.getItem(key) : null;
            } catch(e) {
                return null;
            }
        }
        
        function safeSetItem(key, value) {
            try {
                if (localStorage) {
                    localStorage.setItem(key, value);
                    return true;
                }
            } catch(e) {}
            return false;
        }
        
        // User Management Functions
        function login() {
            const username = document.getElementById('usernameInput').value.trim();
            const pin = document.getElementById('pinInput').value.trim();
            const rememberMe = document.getElementById('rememberMeCheckbox').checked;
            
            if (!username) {
                alert('אנא הכניסי שם משתמש');
                return;
            }
            
            if (pin && (pin.length < 4 || pin.length > 8 || !/^\d+$/.test(pin))) {
                alert('סיסמא חייבת להיות 4-8 ספרות בלבד');
                return;
            }
            
            // Check if user already exists with a PIN
            const existingPin = safeGetItem(`pin_${username}`);
            if (existingPin && !pin) {
                // User has a PIN but didn't enter it - go to PIN screen
                document.getElementById('pinUsername').textContent = username;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('pinScreen').style.display = 'block';
                return;
            } else if (existingPin && pin) {
                // User has PIN and entered one - verify
                if (pin !== existingPin) {
                    alert('❌ סיסמא שגויה');
                    return;
                }
            } else if (pin) {
                // New user setting a PIN
                safeSetItem(`pin_${username}`, pin);
            }
            
            proceedToMainApp(username, rememberMe);
        }
        
        function verifyPin() {
            const username = document.getElementById('pinUsername').textContent;
            const enteredPin = document.getElementById('pinVerification').value.trim();
            const correctPin = safeGetItem(`pin_${username}`);
            
            if (enteredPin === correctPin) {
                proceedToMainApp(username);
            } else {
                alert('❌ סיסמא שגויה');
                document.getElementById('pinVerification').value = '';
            }
        }
        
        function backToLogin() {
            document.getElementById('pinScreen').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('pinVerification').value = '';
        }
        
        function proceedToMainApp(username, rememberMe = false) {
            currentUsername = username;
            document.getElementById('currentUser').textContent = username;
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('pinScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Save login session if remember me is checked
            if (rememberMe) {
                const sessionData = {
                    username: username,
                    timestamp: Date.now(),
                    expiresAt: Date.now() + (30 * 24 * 60 * 60 * 1000), // 30 days
                    isGoogleUser: false
                };
                safeSetItem('loginSession', JSON.stringify(sessionData));
            } else {
                // Clear any existing session
                localStorage.removeItem('loginSession');
            }
            
            // Save last username for convenience
            safeSetItem('lastUsername', username);
            
            loadUserData();
            generateCalendar();
            
            // Show login success message if remember me is enabled
            if (rememberMe) {
                setTimeout(() => {
                    alert(`🎉 התחברת בהצלחה!\n\n✅ תישארי מחוברת למשך 30 ימים\n\n💡 תוכלי תמיד להתנתק ידנית מהתפריט הצד`);
                }, 1000);
            }
            

        }
        
        // Data Backup and Restore Functions
        function exportData() {
            if (!currentUsername) {
                alert('אנא היכנסי למערכת תחילה');
                return;
            }
            
            const dataToExport = {
                username: currentUsername,
                exportDate: new Date().toLocaleDateString('he-IL'),
                entries: entries
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            const today = new Date();
            const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            link.download = `גיבוי-יומן-רגשי-${currentUsername}-${dateStr}.json`;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('✅ הקובץ הורד בהצלחה! \n\n💡 טיפ: שמרי את הקובץ בגוגל דרייב, דרופבוקס או כל שירות ענן אחר כדי לגבות אותו.');
        }
        
        function importData() {
            if (!currentUsername) {
                alert('אנא היכנסי למערכת תחילה');
                return;
            }
            
            document.getElementById('fileInput').click();
        }
        
        function handleFileImport(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!importedData.entries) {
                        alert('❌ הקובץ לא תקין');
                        return;
                    }
                    
                    if (confirm(`📥 האם את רוצה לשחזר את הנתונים מ-${importedData.exportDate || 'גיבוי קודם'}?\n\n⚠️ זה ימחק את הנתונים הנוכחיים של ${currentUsername}`)) {
                        entries = importedData.entries;
                        
                        // Save to localStorage
                                    if (!safeSetItem(getUserDataKey(), JSON.stringify(entries))) {
                // Could not save to localStorage
            }
                        
                        generateCalendar();
                        alert('✅ הנתונים שוחזרו בהצלחה!');
                    }
                } catch (error) {
                    alert('❌ שגיאה בקריאת הקובץ. אנא ודאי שזה קובץ גיבוי תקין.');
                }
            };
            
            reader.readAsText(file);
            input.value = ''; // Reset input
        }
        
        // Export to Excel function
        function exportToExcel() {
            if (!currentUsername) {
                alert('אנא היכנסי למערכת תחילה');
                return;
            }
            
            if (Object.keys(entries).length === 0) {
                alert('אין נתונים לייצוא');
                return;
            }
            
            // Mood mapping for Excel export
            const moodMapping = {
                '😊': 'שמחה',
                '😌': 'רוגע', 
                '💝': 'חמלה',
                '😢': 'עצבות',
                '😰': 'פחד',
                '😤': 'עצבנות',
                '😫': 'עייפות',
                '😕': 'בלבול',
                '⚡': 'חיות',
                '💪': 'ביטחון'
            };
            
            let csvContent = "תאריך,מצב רוח,רגשות ומחשבות,הכרת תודה,הערות מדיטציה,תצפית,רגש,צורך,בקשה,איך הגבתי,משהו דומה בעבר,הרגשה אחרי,השפעה על קשרים,השפעה על אחרים,מה לשנות,הצעד הבא,מעקב התקדמות,סימון מיוחד\n";
            
            Object.keys(entries).sort().forEach(dateKey => {
                const entry = entries[dateKey];
                // Create a date object and format it correctly without timezone issues
                const dateObj = new Date(dateKey + 'T12:00:00');
                const day = String(dateObj.getDate()).padStart(2, '0');
                const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                const year = dateObj.getFullYear();
                const date = `${day}/${month}/${year}`;
                const mood = moodMapping[entry.selectedMood] || entry.selectedMood || '';
                const feelings = (entry.feelings || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const gratitude = (entry.gratitude || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const meditationNotes = (entry.meditationNotes || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const observation = (entry.observation || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const feeling = (entry.feeling || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const need = (entry.need || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const request = (entry.request || '').replace(/"/g, '""').replace(/\n/g, ' ');
                
                // Pattern analysis fields
                const reactionResponse = (entry.reaction_response || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const similarPast = (entry.similar_past || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const feelingsAfter = (entry.feelings_after || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const impactRelationships = (entry.impact_relationships || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const impactOthers = (entry.impact_others || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const wantToChange = (entry.want_to_change || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const nextStep = (entry.next_step || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const followUpProgress = (entry.follow_up_progress || '').replace(/"/g, '""').replace(/\n/g, ' ');
                
                let specialMark = '';
                if (entry.specialDay === 'significant') specialMark = 'יום משמעותי במסע';
                else if (entry.specialDay === 'review') specialMark = 'יש עוד מה להעמיק';
                
                csvContent += `"${date}","${mood}","${feelings}","${gratitude}","${meditationNotes}","${observation}","${feeling}","${need}","${request}","${reactionResponse}","${similarPast}","${feelingsAfter}","${impactRelationships}","${impactOthers}","${wantToChange}","${nextStep}","${followUpProgress}","${specialMark}"\n`;
            });
            
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            const today = new Date();
            const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            link.download = `יומן-רגשי-${currentUsername}-${dateStr}.csv`;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('✅ הקובץ אקסל הורד בהצלחה! \n\n💡 פתחי אותו באקסל או בגוגל שיטס לצפייה ועיבוד הנתונים.');
        }
        
        // Help functions
        function showHelp() {
            document.getElementById('helpModal').style.display = 'block';
        }
        
        function closeHelp() {
            document.getElementById('helpModal').style.display = 'none';
        }
        
        function getUserDataKey() {
            return `emotionalCalendar_${currentUsername}`;
        }
        
        // Load user-specific data from localStorage
        function loadUserData() {
            const savedData = safeGetItem(getUserDataKey());
            if (savedData) {
                try {
                    entries = JSON.parse(savedData);
                } catch(e) {
                    // Error parsing saved data, starting fresh
                    entries = {};
                }
            } else {
                entries = {};
            }
        }

        // Side menu controls
        function openMenu() {
            const overlay = document.getElementById('menuOverlay');
            const sideMenu = document.getElementById('sideMenu');
            if (overlay && sideMenu) {
                overlay.style.display = 'block';
                sideMenu.classList.add('open');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeMenu() {
            const overlay = document.getElementById('menuOverlay');
            const sideMenu = document.getElementById('sideMenu');
            if (overlay && sideMenu) {
                overlay.style.display = 'none';
                sideMenu.classList.remove('open');
                document.body.style.overflow = '';
            }
        }
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // load Google scripts in background
            loadGoogleScripts();
            
            // Check for auto login first
            if (!checkAutoLogin()) {
                // Check if there's a saved user for convenience
                const savedUsername = safeGetItem('lastUsername');
                if (savedUsername) {
                    document.getElementById('usernameInput').value = savedUsername;
                }
                
                // Show session status
                const sessionData = safeGetItem('loginSession');
                if (sessionData) {
                    try {
                        const session = JSON.parse(sessionData);
                        const now = Date.now();
                        if (session.expiresAt <= now) {
                                                    // Session expired, clear it
                        localStorage.removeItem('loginSession');
                    }
                } catch (e) {
                    console.error('Error checking session:', e);
                    localStorage.removeItem('loginSession');
                }
                }
            }
            
            // Set up mood and special day selection
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Handle mood selection
                    if (this.dataset.mood) {
                        if (this.classList.contains('selected')) {
                            // If already selected, deselect
                            this.classList.remove('selected');
                        } else {
                            // Otherwise select this and deselect others
                            document.querySelectorAll('.mood-btn[data-mood]').forEach(b => b.classList.remove('selected'));
                            this.classList.add('selected');
                        }
                    }
                    // Handle special day selection
                    if (this.dataset.special) {
                        if (this.classList.contains('selected')) {
                            // If already selected, deselect
                            this.classList.remove('selected');
                        } else {
                            // Otherwise select this and deselect others
                            document.querySelectorAll('.mood-btn[data-special]').forEach(b => b.classList.remove('selected'));
                            this.classList.add('selected');
                        }
                    }
                });
            });
            
            // Allow Enter key in inputs
            document.getElementById('usernameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            document.getElementById('pinInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            const pinVerificationEl = document.getElementById('pinVerification');
            if (pinVerificationEl) {
                pinVerificationEl.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        verifyPin();
                    }
                });
                
                pinVerificationEl.addEventListener('input', function(e) {
                    this.value = this.value.replace(/[^0-9]/g, '');
                });
            }
            
            // Only allow numbers in PIN fields
            document.getElementById('pinInput').addEventListener('input', function(e) {
                this.value = this.value.replace(/[^0-9]/g, '');
            });
            


            // Close side menu with ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeMenu();
                    // Also close meditations side panel if open
                    const meditationsSidePanel = document.getElementById('meditationsSidePanel');
                    if (meditationsSidePanel && meditationsSidePanel.style.display === 'block') {
                        closeMeditationsSidePanel();
                    }
                    
                    // Also close emotions side panel if open
                    const emotionsSidePanel = document.getElementById('emotionsSidePanel');
                    if (emotionsSidePanel && emotionsSidePanel.style.display === 'block') {
                        closeEmotionsSidePanel();
                    }
                    
                    // Also close needs side panel if open
                    const needsSidePanel = document.getElementById('needsSidePanel');
                    if (needsSidePanel && needsSidePanel.style.display === 'block') {
                        closeNeedsSidePanel();
                    }
                }
            });
            
            // Check session status before page unload
            window.addEventListener('beforeunload', function() {
                const sessionData = safeGetItem('loginSession');
                if (sessionData) {
                    try {
                        const session = JSON.parse(sessionData);
                        const now = Date.now();
                        if (session.expiresAt <= now) {
                            // Session expired, clear it
                            localStorage.removeItem('loginSession');
                        }
                    } catch (e) {
                        console.error('Error checking session before unload:', e);
                        localStorage.removeItem('loginSession');
                    }
                }
            });
            
            // Check session status when page becomes visible
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    // Page became visible, check session status
                    const sessionData = safeGetItem('loginSession');
                    if (sessionData) {
                        try {
                            const session = JSON.parse(sessionData);
                            const now = Date.now();
                            if (session.expiresAt <= now) {
                                // Session expired, show login screen
                                alert('❌ תוקף ההתחברות פג. אנא התחברי מחדש.');
                                logout();
                            }
                        } catch (e) {
                            console.error('Error checking session on visibility change:', e);
                            localStorage.removeItem('loginSession');
                        }
                    }
                }
            });
            
                                // Sections start collapsed by default - no need to force them open
            const breathingSection = document.getElementById('breathingSection');
            const meditationSection = document.getElementById('meditationSection');
            const cnvcSection = document.getElementById('cnvcSection');
            const patternsSection = document.getElementById('patternsSection');
            
            // Ensure sections start in collapsed state
            if (breathingSection) breathingSection.classList.add('collapsed');
            if (meditationSection) meditationSection.classList.add('collapsed');
            if (cnvcSection) cnvcSection.classList.add('collapsed');
            if (patternsSection) patternsSection.classList.add('collapsed');
        
        // Sections are now collapsible - no need for forced visibility
        });
        
        // Define logout function globally
        window.logout = function() {
            if (confirm('האם את בטוחה שברצונך להתנתק?')) {
                currentUsername = null;
                entries = {};
                
                // Clear login session
                localStorage.removeItem('loginSession');
                
                // Clear Google session if exists
                if (googleAccessToken) {
                    googleAccessToken = null;
                    googleUser = null;
                }
                
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('usernameInput').value = '';
                document.getElementById('pinInput').value = '';
                
                // Reset remember me checkboxes
                document.getElementById('rememberMeCheckbox').checked = false;
                document.getElementById('rememberMeGoogleCheckbox').checked = false;
                

                
                const pinVerificationEl = document.getElementById('pinVerification');
                if (pinVerificationEl) {
                    pinVerificationEl.value = '';
                }
                closeMenu();
            }
        }
        
        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            const dayModal = document.getElementById('dayModal');
            const helpModal = document.getElementById('helpModal');
            const meditationsModal = document.getElementById('meditationsModal');
            const emotionsModal = document.getElementById('emotionsModal');
            const needsModal = document.getElementById('needsModal');
            const meditationsSidePanel = document.getElementById('meditationsSidePanel');
            
            if (event.target === dayModal) {
                closeModal();
            }
            if (event.target === helpModal) {
                closeHelp();
            }
            if (event.target === meditationsModal) {
                closeMeditationsLibrary();
            }
            if (event.target === meditationsSidePanel) {
                closeMeditationsSidePanel();
            }
            if (event.target === emotionsModal) {
                closeEmotionsReference();
            }
            if (event.target === emotionsSidePanel) {
                closeEmotionsSidePanel();
            }
            if (event.target === needsModal) {
                closeNeedsReference();
            }
            if (event.target === needsSidePanel) {
                closeNeedsSidePanel();
            }
        });

        function closeNeedsReference() {
            document.getElementById('needsModal').style.display = 'none';
        }
        
        function showMeditationsLibrary() {
            const sidePanel = document.getElementById('meditationsSidePanel');
            sidePanel.style.display = 'block';
            // Add active class after a small delay to trigger animation
            setTimeout(() => {
                sidePanel.classList.add('active');
                // Load saved favorites
                loadSavedFavorites();
            }, 10);
        }
        
        function closeMeditationsSidePanel() {
            const sidePanel = document.getElementById('meditationsSidePanel');
            sidePanel.classList.remove('active');
            // Hide panel after animation completes
            setTimeout(() => {
                sidePanel.style.display = 'none';
            }, 300);
        }
        
        function closeMeditationsLibrary() {
            document.getElementById('meditationsModal').style.display = 'none';
        }
        
        // Favorites functionality
        let showOnlyFavorites = false;
        
        function toggleFavorite(circleElement, meditationName, event) {
            // Prevent event bubbling to parent link
            if (event) {
                event.stopPropagation();
            }
            
            // Toggle favorite state
            if (circleElement.classList.contains('filled')) {
                circleElement.classList.remove('filled');
                circleElement.textContent = '☆';
                removeFavorite(meditationName);
            } else {
                circleElement.classList.add('filled');
                circleElement.textContent = '★';
                addFavorite(meditationName);
            }
            
            // Update display if filter is active
            if (showOnlyFavorites) {
                showOnlyFavoritesDisplay();
            }
        }
        
        function addFavorite(meditationName) {
            const favorites = getFavorites();
            if (!favorites.includes(meditationName)) {
                favorites.push(meditationName);
                saveFavorites(favorites);
            }
        }
        
        function removeFavorite(meditationName) {
            const favorites = getFavorites();
            const index = favorites.indexOf(meditationName);
            if (index > -1) {
                favorites.splice(index, 1);
                saveFavorites(favorites);
            }
        }
        
        function getFavorites() {
            try {
                const saved = localStorage.getItem('meditationFavorites');
                return saved ? JSON.parse(saved) : [];
            } catch (e) {
                return [];
            }
        }
        
        function saveFavorites(favorites) {
            try {
                localStorage.setItem('meditationFavorites', JSON.stringify(favorites));
            } catch (e) {
                console.error('Failed to save favorites:', e);
            }
        }
        
        function toggleFavoritesFilter() {
            showOnlyFavorites = !showOnlyFavorites;
            const btn = document.getElementById('favoritesFilterBtn');
            
            if (showOnlyFavorites) {
                btn.textContent = 'הצג הכל';
                btn.classList.add('active');
                showOnlyFavoritesDisplay();
            } else {
                btn.textContent = 'הצג מועדפות';
                btn.classList.remove('active');
                showAllMeditations();
            }
        }
        
        function showOnlyFavoritesDisplay() {
            const favorites = getFavorites();
            const allContainers = document.querySelectorAll('.meditations-link-container');
            
            allContainers.forEach(container => {
                // Get the meditation name from the link span (first span inside the link)
                const linkSpan = container.querySelector('.meditations-link span');
                if (linkSpan) {
                    const meditationName = linkSpan.textContent;
                    if (favorites.includes(meditationName)) {
                        container.style.display = 'flex';
                    } else {
                        container.style.display = 'none';
                    }
                }
            });
        }
        
        function showAllMeditations() {
            const allContainers = document.querySelectorAll('.meditations-link-container');
            allContainers.forEach(container => {
                container.style.display = 'flex';
            });
        }
        
        // Load saved favorites on page load
        function loadSavedFavorites() {
            const favorites = getFavorites();
            const allContainers = document.querySelectorAll('.meditations-link-container');
            
            allContainers.forEach(container => {
                const linkSpan = container.querySelector('.meditations-link span');
                const circle = container.querySelector('.favorite-circle');
                
                if (linkSpan && circle) {
                    const meditationName = linkSpan.textContent;
                    if (favorites.includes(meditationName)) {
                        circle.classList.add('filled');
                        circle.textContent = '★';
                    } else {
                        circle.textContent = '☆';
                    }
                }
            });
        }
        
        // Check if user is already logged in
        function checkAutoLogin() {
            const sessionData = safeGetItem('loginSession');
            if (sessionData) {
                try {
                    const session = JSON.parse(sessionData);
                    const now = Date.now();
                    
                    // Check if session is still valid (not expired)
                    if (session.expiresAt > now) {
                        // Auto login
                        currentUsername = session.username;
                        document.getElementById('currentUser').textContent = session.username;
                        document.getElementById('loginScreen').style.display = 'none';
                        document.getElementById('mainApp').style.display = 'block';
                        
                        loadUserData();
                        generateCalendar();
                        return true;
                    } else {
                        // Session expired, clear it
                        localStorage.removeItem('loginSession');
                    }
                } catch (e) {
                    console.error('Error parsing session data:', e);
                    localStorage.removeItem('loginSession');
                }
            }
            return false;
        }
        
        // Safe localStorage wrapper functions
        function safeGetItem(key) {
            try {
                return localStorage.getItem(key);
            } catch (e) {
                console.error('Error accessing localStorage:', e);
                return null;
            }
        }

        function safeSetItem(key, value) {
            try {
                localStorage.setItem(key, value);
            } catch (e) {
                console.error('Error setting localStorage:', e);
            }
        }

        // PWA Installation
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            
            // Show install button or notification
            showInstallPrompt();
        });

        function showInstallPrompt() {
            // Create install button if it doesn't exist
            if (!document.getElementById('installButton')) {
                const installButton = document.createElement('button');
                installButton.id = 'installButton';
                installButton.textContent = '📱 התקן אפליקציה';
                installButton.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 20px;
                    background: #8cb89c;
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 25px;
                    font-size: 14px;
                    cursor: pointer;
                    z-index: 10000;
                    box-shadow: 0 4px 12px rgba(140, 184, 156, 0.3);
                    transition: all 0.3s ease;
                `;
                
                installButton.addEventListener('click', installApp);
                installButton.addEventListener('mouseenter', () => {
                    installButton.style.transform = 'translateY(-2px)';
                    installButton.style.boxShadow = '0 6px 16px rgba(140, 184, 156, 0.4)';
                });
                installButton.addEventListener('mouseleave', () => {
                    installButton.style.transform = 'translateY(0)';
                    installButton.style.boxShadow = '0 4px 12px rgba(140, 184, 156, 0.3)';
                });
                
                document.body.appendChild(installButton);
                
                // Auto-hide after 10 seconds
                setTimeout(() => {
                    if (installButton.parentNode) {
                        installButton.style.opacity = '0';
                        setTimeout(() => {
                            if (installButton.parentNode) {
                                installButton.remove();
                            }
                        }, 300);
                    }
                }, 10000);
            }
        }

        function installApp() {
            if (deferredPrompt) {
                // Show the install prompt
                deferredPrompt.prompt();
                
                // Wait for the user to respond to the prompt
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                    
                    // Hide the install button
                    const installButton = document.getElementById('installButton');
                    if (installButton) {
                        installButton.remove();
                    }
                });
            }
        }

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Check if user is already logged in
        function checkAutoLogin() {
            const sessionData = safeGetItem('loginSession');
            if (sessionData) {
                try {
                    const session = JSON.parse(sessionData);
                    const now = Date.now();
                    
                    // Check if session is still valid (not expired)
                    if (session.expiresAt > now) {
                        // Auto login
                        currentUsername = session.username;
                        document.getElementById('currentUser').textContent = session.username;
                        document.getElementById('loginScreen').style.display = 'none';
                        document.getElementById('mainApp').style.display = 'block';
                        
                        loadUserData();
                        generateCalendar();
                        return true;
                    } else {
                        // Session expired, clear it
                        localStorage.removeItem('loginSession');
                    }
                } catch (e) {
                    console.error('Error parsing session data:', e);
                    localStorage.removeItem('loginSession');
                }
            }
            return false;
        }

    </script>
</body>
</html>


